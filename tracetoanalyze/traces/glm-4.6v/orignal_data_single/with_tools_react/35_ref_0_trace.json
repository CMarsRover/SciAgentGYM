{
  "id": "35_ref_0",
  "query": "设观测数据 O = (Y, M, A, Z, W, X) 从半参数模型 M_sp 中独立同分布产生。暴露 A∈{0,1}，中介 M∈R，结局 Y∈R，存在未观测混杂 U, V，它们由代理变量 Z, W 及基线协变量 X 部分反映。关注参数为\nψ = E{ Y(A, M(0)) }，即将暴露固定为个体实际取值 A，而中介固定为在 A=0 下的潜在值 M(0) 时的平均结局。\n\n在 proximal mediation 框架下，假设存在如下 bridge 函数：\n- outcome bridge 函数 h1(w, m, a, x) 与 h0(w, a, x)，对所有 a∈{0,1} 满足\n  1) E[ Y | Z, A, M, X ] = ∫ h1(w, M, A, X) dF(w | Z, A, M, X)，\n  2) E[ h1(W, M, a, X) | Z, A=0, X ] = ∫ h0(w, a, X) dF(w | Z, A=0, X)。\n- exposure bridge 函数 q0(z, x) 与 q1(z, m, x)，满足\n  3) f(A=1 | W, X)/f(A=0 | W, X) = E[ q0(Z, X) | W, A=0, X ]，\n  4) E[ q0(Z, X) | W, A=0, M, X ] · { f(A=0 | W, M, X)/f(A=1 | W, M, X) } = E[ q1(Z, M, X) | W, A=1, M, X ]。\n并假设：\n(i) 上述积分方程在真实分布下可解；\n(ii) 满足必要的完备性条件，使解唯一；\n(iii) 条件期望算子 T1: g→E[g(W,M,A,X)|Z,A,M,X] 与 T0: g→E[g(W,M,X)|Z,A=0,X] 在相应 L2 空间为满射；\n(iv) 在真实分布下所有 bridge 函数均存在且唯一。\n\n记 I(A=a) 为指示函数 1{A=a}。已知某符号推导工具给出一个候选影响函数 EIF_computed(O)，同时标准理论给出 canonical efficient influence function EIF_theory(O) 的一个具体解析形式，但不在此直接给出。\n\n在此背景下，回答下列问题（所有结果均以符号表达式形式给出）：\n\n(1) 在假设 (i)-(iv) 成立且 bridge 函数唯一的前提下，用 Y, M, A, Z, W, X, ψ 以及 h1, h0, q0, q1 和指示函数 I(A=a) 写出 ψ 在模型 M_sp 中的 canonical efficient influence function EIF(O) 的一个完整解析表达式。并说明该表达式与标准理论 EIF_theory(O) 的对应关系（不要求推导过程）。\n\n(2) 将候选 EIF_computed(O) 与标准 EIF_theory(O) 的结构进行比较，指出：\n   - 二者在哪些具体项上存在符号或形式差异（特别是涉及 h1 与 h0 之差的项）；\n   - 解释为何 EIF_theory(O) 才是 canonical EIF（可从 EIF 需满足零均值和对可容许干扰方向正交等性质进行讨论），并说明若将 EIF_theory 中涉及 (h1 − h0) 的项误写为 (h0 − h1)，一般会导致怎样的偏差或失效（例如不再满足零均值性）。\n\n(3) 在样本量 n=5000、随机种子 seed=123、confounder_strength=0.7 的设定下，给出一个合理的、具体的模拟数据生成机制示例（不要求与任何工具内部实现完全一致），说明：\n   - U, V, X, Z, W, A, M, Y 的生成顺序及条件依赖结构，使之体现 proximal mediation 的思想（即 U, V 同时影响中介和结局，而 Z, W 作为 U, V 的代理，与 A, M, Y 相关）；\n   - 写出一套明确的概率生成方程（可以是高斯线性模型或 logistic/Bernoulli 模型形式，如 A|W,X 为 Bernoulli(expit(…)) 等），参数可自拟但须固定；\n   - 说明在这种生成模型下，为何存在满足题干条件的 bridge 函数（可用直观论述，无需给出显式形式）。\n\n(4) 在只观测到 (Y, M, A, Z, W, X) 的前提下，回答：\n   - 如何基于样本理论上估计 h1, h0, q0, q1，例如通过一系列回归或最小二乘近似地求解上述积分方程；\n   - 在给出 h1_hat, h0_hat, q0_hat, q1_hat 的基础上，写出 ψ 的一个 plug-in（或 one-step）估计 ψ_hat 的显式样本表达式，要求直接用样本平均形式表示，且与 canonical EIF 的结构保持一致；\n   - 说明如何利用样本 EIF 构造 ψ_hat 的标准误和置信区间的估计方法（例如基于 EIF 的样本方差）。\n\n(5) 假设已经基于生成数据估计得到了 bridge 函数，并据此可在每个样本点上计算 EIF_theory(O_i) 的数值。设计一个理论上的数值验证方案，说明：\n   - 如何检验 EIF 的零均值性（给出基于样本平均和标准误的检验步骤或统计量构造思路）；\n   - 如何检验 EIF 的有限方差与数值稳定性（如通过样本方差、直方图或核密度估计等手段）；\n   - 如何利用 EIF 的正交性性质设计数值实验：例如比较“粗糙”估计与“精细”估计 bridge 函数时得到的 ψ_hat 的偏差与方差表现，应呈现怎样的趋势以符合正交性预期。\n\n(6) 基于上述讨论，总结：\n   - 在 proximal mediation 框架下构造 ψ 的 EIF 的关键难点（例如 bridge 方程可解性、完备性条件、模型错设风险等）；\n   - 在哪些情形下，bridge 函数可能不存在或不唯一，从而 canonical EIF 失效（例如代理 W, Z 太弱或条件独立结构不成立）；\n   - 若 q0 或 q1 的估计模型严重错设，将对 ψ_hat 及基于 EIF 的性质（如一致性、零均值性、方差估计准确性）造成怎样的影响。\n\n所有小问的结果要求以符号表达式或关系式及定性文字说明给出，不要求且不得给出任何数值计算结果。",
  "query_data": {
    "id": "35_ref_0",
    "original_id": 35,
    "refined_index": 0,
    "question": "设观测数据 O = (Y, M, A, Z, W, X) 从半参数模型 M_sp 中独立同分布产生。暴露 A∈{0,1}，中介 M∈R，结局 Y∈R，存在未观测混杂 U, V，它们由代理变量 Z, W 及基线协变量 X 部分反映。关注参数为\nψ = E{ Y(A, M(0)) }，即将暴露固定为个体实际取值 A，而中介固定为在 A=0 下的潜在值 M(0) 时的平均结局。\n\n在 proximal mediation 框架下，假设存在如下 bridge 函数：\n- outcome bridge 函数 h1(w, m, a, x) 与 h0(w, a, x)，对所有 a∈{0,1} 满足\n  1) E[ Y | Z, A, M, X ] = ∫ h1(w, M, A, X) dF(w | Z, A, M, X)，\n  2) E[ h1(W, M, a, X) | Z, A=0, X ] = ∫ h0(w, a, X) dF(w | Z, A=0, X)。\n- exposure bridge 函数 q0(z, x) 与 q1(z, m, x)，满足\n  3) f(A=1 | W, X)/f(A=0 | W, X) = E[ q0(Z, X) | W, A=0, X ]，\n  4) E[ q0(Z, X) | W, A=0, M, X ] · { f(A=0 | W, M, X)/f(A=1 | W, M, X) } = E[ q1(Z, M, X) | W, A=1, M, X ]。\n并假设：\n(i) 上述积分方程在真实分布下可解；\n(ii) 满足必要的完备性条件，使解唯一；\n(iii) 条件期望算子 T1: g→E[g(W,M,A,X)|Z,A,M,X] 与 T0: g→E[g(W,M,X)|Z,A=0,X] 在相应 L2 空间为满射；\n(iv) 在真实分布下所有 bridge 函数均存在且唯一。\n\n记 I(A=a) 为指示函数 1{A=a}。已知某符号推导工具给出一个候选影响函数 EIF_computed(O)，同时标准理论给出 canonical efficient influence function EIF_theory(O) 的一个具体解析形式，但不在此直接给出。\n\n在此背景下，回答下列问题（所有结果均以符号表达式形式给出）：\n\n(1) 在假设 (i)-(iv) 成立且 bridge 函数唯一的前提下，用 Y, M, A, Z, W, X, ψ 以及 h1, h0, q0, q1 和指示函数 I(A=a) 写出 ψ 在模型 M_sp 中的 canonical efficient influence function EIF(O) 的一个完整解析表达式。并说明该表达式与标准理论 EIF_theory(O) 的对应关系（不要求推导过程）。\n\n(2) 将候选 EIF_computed(O) 与标准 EIF_theory(O) 的结构进行比较，指出：\n   - 二者在哪些具体项上存在符号或形式差异（特别是涉及 h1 与 h0 之差的项）；\n   - 解释为何 EIF_theory(O) 才是 canonical EIF（可从 EIF 需满足零均值和对可容许干扰方向正交等性质进行讨论），并说明若将 EIF_theory 中涉及 (h1 − h0) 的项误写为 (h0 − h1)，一般会导致怎样的偏差或失效（例如不再满足零均值性）。\n\n(3) 在样本量 n=5000、随机种子 seed=123、confounder_strength=0.7 的设定下，给出一个合理的、具体的模拟数据生成机制示例（不要求与任何工具内部实现完全一致），说明：\n   - U, V, X, Z, W, A, M, Y 的生成顺序及条件依赖结构，使之体现 proximal mediation 的思想（即 U, V 同时影响中介和结局，而 Z, W 作为 U, V 的代理，与 A, M, Y 相关）；\n   - 写出一套明确的概率生成方程（可以是高斯线性模型或 logistic/Bernoulli 模型形式，如 A|W,X 为 Bernoulli(expit(…)) 等），参数可自拟但须固定；\n   - 说明在这种生成模型下，为何存在满足题干条件的 bridge 函数（可用直观论述，无需给出显式形式）。\n\n(4) 在只观测到 (Y, M, A, Z, W, X) 的前提下，回答：\n   - 如何基于样本理论上估计 h1, h0, q0, q1，例如通过一系列回归或最小二乘近似地求解上述积分方程；\n   - 在给出 h1_hat, h0_hat, q0_hat, q1_hat 的基础上，写出 ψ 的一个 plug-in（或 one-step）估计 ψ_hat 的显式样本表达式，要求直接用样本平均形式表示，且与 canonical EIF 的结构保持一致；\n   - 说明如何利用样本 EIF 构造 ψ_hat 的标准误和置信区间的估计方法（例如基于 EIF 的样本方差）。\n\n(5) 假设已经基于生成数据估计得到了 bridge 函数，并据此可在每个样本点上计算 EIF_theory(O_i) 的数值。设计一个理论上的数值验证方案，说明：\n   - 如何检验 EIF 的零均值性（给出基于样本平均和标准误的检验步骤或统计量构造思路）；\n   - 如何检验 EIF 的有限方差与数值稳定性（如通过样本方差、直方图或核密度估计等手段）；\n   - 如何利用 EIF 的正交性性质设计数值实验：例如比较“粗糙”估计与“精细”估计 bridge 函数时得到的 ψ_hat 的偏差与方差表现，应呈现怎样的趋势以符合正交性预期。\n\n(6) 基于上述讨论，总结：\n   - 在 proximal mediation 框架下构造 ψ 的 EIF 的关键难点（例如 bridge 方程可解性、完备性条件、模型错设风险等）；\n   - 在哪些情形下，bridge 函数可能不存在或不唯一，从而 canonical EIF 失效（例如代理 W, Z 太弱或条件独立结构不成立）；\n   - 若 q0 或 q1 的估计模型严重错设，将对 ψ_hat 及基于 EIF 的性质（如一致性、零均值性、方差估计准确性）造成怎样的影响。\n\n所有小问的结果要求以符号表达式或关系式及定性文字说明给出，不要求且不得给出任何数值计算结果。",
    "answer": "{'(1)': '定义指示函数 I(A=a) = 1{A = a}。在题设假设 (i)-(iv) 及 bridge 函数唯一的前提下，ψ = E{Y(A, M(0))} 的 canonical efficient influence function EIF(O) 可写为：\\nEIF(O) = -ψ\\n          + (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )\\n          + ( h1(W, M, 0, X) - h0(W, 0, X) ) · I(A=0)\\n          + ( h1(W, M, 1, X) - h0(W, 1, X) ) · I(A=0) · q0(Z, X)\\n          + h0(W, A, X)。\\n该表达式正是题设所称的标准理论形式 EIF_theory(O)，在真实数据分布下满足 E{EIF(O)} = 0，且为 ψ 在模型 M_sp 的 canonical efficient influence function。', '(2)': '- 结构差异：\\n  记 EIF_computed(O) 为符号工具给出的候选形式，则两者比较可见：\\n  1) 在含残差 (Y - h1(W, M, A, X)) 的部分，两者均为 (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )，仅记号上 I(A,0) 与 I(A=0) 等价，不构成本质差异。\\n  2) 在与 h0 与 h1 之差相关的两项上，EIF_theory(O) 采用 (h1(W, M, a, X) - h0(W, a, X)) · I(A=0)（及乘以 q0(Z, X) 的对应项），而 EIF_computed(O) 中相应部分写成 -(h0(W, a, X) - h1(W, M, a, X)) · I(A=0)（以及相应乘 q0(Z, X) 的项）。虽然在代数上 (h1 - h0) = -(h0 - h1)，但若只在局部项改变符号而不整体调整其他项，会改变这些项在 EIF 中的净贡献。\\n- 为何 EIF_theory(O) 为 canonical EIF：\\n  1) canonical EIF 需满足两个核心性质：\\n     - 无偏性：在真实分布与真实 bridge 函数下，E{EIF(O)} = 0；\\n     - 正交性与效率：EIF 属于目标参数的影响函数集合，并且是该集合在模型切空间上的投影，因而对所有可容许扰动方向的内积等于参数 ψ 的路径导数，且具有最小方差。\\n  2) 在 proximal mediation 中，上述性质依赖 bridge 方程保证若干条件期望为 0，例如\\n     - E[ Y − h1(W, M, A, X) | Z, A, M, X ] = 0，\\n     - 与 h0、q0、q1 相关的条件期望结合构成对未观测混杂的校正。\\n     EIF_theory(O) 正是按这些条件将残差项和桥函数项组合，使整体在真实分布下的期望为 0，并实现对切空间扰动的正确 Riesz 表示。\\n  3) 若将 EIF_theory 中 (h1 − h0) 项误改为 (h0 − h1)，而保持其他项不变，则在真实桥函数下，相关项的期望符号会被翻转，从而打破原本精确相消的结构。一般情况下：\\n     - 总体期望 E{EIF(O)} 不再为 0，因此该函数不再是 ψ 的影响函数；\\n     - 对得分方向的内积不再等于 ψ 的路径导数，失去 canonical 与效率性质。\\n  因此，在保持整式其他结构不变的情况下，只有标准形式 EIF_theory(O) 对应的 (h1 − h0) 符号选择才满足影响函数与效率的要求。', '(3)': '给出一个具体的模拟机制示例（所有随机变量独立样本复制 n=5000 次，随机种子仅控制伪随机数但不出现在表达式中）：\\n- 生成顺序与依赖结构：\\n  1) 基线与未观测混杂：\\n     - X ~ N(0, 1)，\\n     - U ~ N(0, 1)，\\n     - V ~ N(0, 1)，\\n     假定 (X, U, V) 互相独立。\\n  2) 代理变量：令 confounder_strength 通过系数反映在下式中：\\n     - Z = c_ZU · U + c_ZV · V + c_ZX · X + ε_Z，ε_Z ~ N(0, 1)，\\n     - W = c_WU · U + c_WX · X + ε_W，ε_W ~ N(0, 1)，\\n     其中 c_ZU, c_ZV, c_WU 等为固定常数，可选使其数量级反映 confounder_strength = 0.7（例如 c_ZU=0.7, c_ZV=0.7, c_WU=0.7, c_ZX, c_WX 为较小系数）。这样 Z, W 作为 U, V 的 noisy proxy，与未观测混杂有较强线性相关。\\n  3) 暴露：\\n     - 令 A|W, X ~ Bernoulli( expit(α0 + α1·W + α2·X) )，\\n       其中 expit(t)=1/(1+e^{−t})，α0, α1, α2 为固定常数（如 α0=0, α1>0, α2≠0）。这样 W, X 影响暴露，U 通过 W 间接影响 A，体现未观测混杂。\\n  4) 中介：\\n     - 令 M|A, X, U ~ N( β0 + β1·A + β2·X + β3·U, σ_M^2 )，\\n       其中 β0, β1, β2, β3, σ_M 为固定常数，且 β3≠0，使 U 同时影响中介 M。\\n  5) 结局：\\n     - 令 Y|A, M, X, U, V ~ N( γ0 + γ1·A + γ2·M + γ3·X + γ4·U + γ5·V, σ_Y^2 )，\\n       其中 γ0,…,γ5, σ_Y 为固定常数，且 γ4, γ5≠0，使 U, V 通过直接路径影响 Y，从而在 A–Y 和 M–Y 之间制造未观测混杂。\\n- proximal 结构与 bridge 函数存在的直观说明：\\n  1) 在上述模型中，U, V 同时影响 M 和 Y，导致 A–Y 与 M–Y 关系存在未观测混杂。\\n  2) Z, W 通过线性方程从 (U, V, X) 生成，携带关于 U, V 的信息：\\n     - W 主要是 U 的 noisy proxy（通过 c_WU），同时依赖 X；\\n     - Z 是 (U, V, X) 的混合 noisy proxy（通过 c_ZU, c_ZV, c_ZX）。\\n  3) 若进一步假设适当的条件独立结构（例如给定 U, V, A, M, X 时，Z 不再额外影响 Y；给定 U, V, X 时，W 对 A 的影响仅通过暴露机制等），则可以在相应 L2 空间中构造 h1, h0, q0, q1，使它们满足题设的积分方程。直观上：\\n     - h1(W, M, A, X) 可被视为用 W 替代 Z 对 Y 的条件期望进行“反演”的函数；\\n     - h0(W, A, X) 则通过在 A=0 条件下将 h1 与 Z 的分布联系起来；\\n     - q0, q1 通过 W, Z 上的倾向比分解重构 f(A|U, V, X) 的比值关系。\\n  4) 由于 W, Z 对 U, V 有连续且非退化的线性依赖，在高斯框架下可满足相应完备性假设，从而保证 bridge 函数存在且唯一。', '(4)': '- bridge 函数估计思路：\\n  在仅观测 (Y, M, A, Z, W, X) 的前提下，可按如下步骤估计 h1, h0, q0, q1（用帽子表示估计）：\\n  1) 倾向分布估计：\\n     - 通过 logistic 回归或更灵活的机器学习方法估计 π(W, X) ≈ P(A=1|W, X)，得到 f̂(A=1|W, X) 与 f̂(A=0|W, X)=1−π；\\n     - 同理，在 (W, M, X) 上估计 π_M(W, M, X) ≈ P(A=1|W, M, X)，从而得到 f̂(A|W, M, X)。\\n  2) 估计 outcome bridge h1：\\n     - 利用条件方程 E[Y|Z, A, M, X] = E[h1(W, M, A, X)|Z, A, M, X]；\\n     - 实际中可先在 (Z, A, M, X) 空间对 Y 做回归，得到 μ̂_Y(Z, A, M, X) ≈ E[Y|Z, A, M, X]；\\n     - 再在 (W, M, A, X) 空间构造一个灵活函数族 h1_hat(·)，通过最小二乘或其他风险最小化，使得 E[h1_hat(W, M, A, X)|Z, A, M, X] 在样本上逼近 μ̂_Y(Z, A, M, X)。\\n  3) 估计 outcome bridge h0：\\n     - 在 A=0 子样本上使用方程 E[h1(W, M, a, X)|Z, A=0, X] = E[h0(W, a, X)|Z, A=0, X]；\\n     - 固定 a∈{0,1}，先利用 h1_hat 计算 μ̂_{h1,a}(Z, X) = E[h1_hat(W, M, a, X)|Z, A=0, X]（通过回归近似）；\\n     - 再在 (W, a, X) 空间上拟合 h0_hat(W, a, X)，使得 E[h0_hat(W, a, X)|Z, A=0, X] 在样本上逼近 μ̂_{h1,a}(Z, X)。\\n  4) 估计 exposure bridge q0：\\n     - 由 f(A=1|W, X)/f(A=0|W, X) = E[q0(Z, X)|W, A=0, X]；\\n     - 在 A=0 子样本上，将左端的 odds_hat(W, X) = f̂(A=1|W, X)/f̂(A=0|W, X) 作为“目标”，在 (Z, X) 空间上拟合 q0_hat(Z, X)，使得条件期望 E[q0_hat(Z, X)|W, A=0, X] 逼近 odds_hat(W, X)。\\n  5) 估计 exposure bridge q1：\\n     - 利用 E[q0(Z, X)|W, A=0, M, X] · { f(A=0|W, M, X)/f(A=1|W, M, X) } = E[q1(Z, M, X)|W, A=1, M, X]；\\n     - 用上一步的 q0_hat 和 f̂(A|W, M, X) 构造左端估计，在 A=1 子样本内拟合 q1_hat(Z, M, X)，使其条件期望与左端近似相等。\\n\\n- ψ 的 plug-in / one-step 估计 ψ_hat：\\n  将 canonical EIF 记为\\n  EIF(O; ψ, h1, h0, q0, q1) = -ψ + G(O; h1, h0, q0, q1)，\\n  其中\\n  G(O; h1, h0, q0, q1) = (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )\\n                         + ( h1(W, M, 0, X) - h0(W, 0, X) ) · I(A=0)\\n                         + ( h1(W, M, 1, X) - h0(W, 1, X) ) · I(A=0) · q0(Z, X)\\n                         + h0(W, A, X)。\\n  令 h1_hat, h0_hat, q0_hat, q1_hat 为上述估计，用 one-step 校正思想在样本上令 EIF 平均约为 0，有\\n  0 ≈ (1/n)∑_{i=1}^n EIF(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)\\n    = -ψ_hat + (1/n)∑_{i=1}^n G(O_i; h1_hat, h0_hat, q0_hat, q1_hat)。\\n  因此 ψ_hat 的显式样本表达式为\\n  ψ_hat = (1/n) ∑_{i=1}^n [ (Y_i - h1_hat(W_i, M_i, A_i, X_i)) · ( I(A_i=0) + I(A_i=1) · q1_hat(Z_i, M_i, X_i) )\\n                             + ( h1_hat(W_i, M_i, 0, X_i) - h0_hat(W_i, 0, X_i) ) · I(A_i=0)\\n                             + ( h1_hat(W_i, M_i, 1, X_i) - h0_hat(W_i, 1, X_i) ) · I(A_i=0) · q0_hat(Z_i, X_i)\\n                             + h0_hat(W_i, A_i, X_i) ]。\\n  当 bridge 函数估计足够好时，也可将 G 中的完整结构视为对简单 plug-in 估计（例如 (1/n)∑_i h0_hat(W_i, A_i, X_i)）的一阶校正。\\n\\n- 标准误与置信区间估计：\\n  1) 对每个样本 i 计算估计的 EIF 值：\\n     EIF_hat_i = EIF(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)。\\n  2) 估计 EIF 的样本方差：\\n     - 可取中心化形式 s^2 = (1/(n-1))∑_{i=1}^n (EIF_hat_i - EIF_bar)^2，EIF_bar = (1/n)∑_i EIF_hat_i；\\n     - 或在理论上 E{EIF}=0 的前提下，用 (1/n)∑_i EIF_hat_i^2 近似其二阶矩。\\n  3) ψ_hat 的标准误估计为 se_hat = sqrt( s^2 / n )。\\n  4) 在大样本下，利用正态近似构造 95% 置信区间：\\n     CI_95 = [ ψ_hat − z_{0.975} · se_hat, ψ_hat + z_{0.975} · se_hat ]，其中 z_{0.975} 为标准正态分位数。', '(5)': '- EIF 零均值性检验：\\n  1) 在 n=5000 的样本上，用估计的 bridge 函数计算 EIF_hat_i = EIF_theory(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)。\\n  2) 计算样本平均 μ_hat = (1/n)∑_{i=1}^n EIF_hat_i 和样本方差 s^2 = (1/(n-1))∑_{i=1}^n (EIF_hat_i - μ_hat)^2。\\n  3) 构造 t 统计量 t = μ_hat / sqrt(s^2/n)。在 EIF 正确且 bridge 函数估计良好的情况下，t 在大样本下应接近 0，近似服从标准正态分布。若 |t| 较小（例如小于常用临界值），支持 E{EIF(O)} = 0；若偏离明显，则可能指示 EIF 公式或桥函数估计存在问题。\\n\\n- 有限方差与稳定性检验：\\n  1) 计算 EIF_hat_i 的样本方差 s^2，检查是否处于合理范围，以排除极端爆炸或数值不稳定。\\n  2) 绘制 EIF_hat_i 的直方图与核密度估计，观察其分布是否存在极端长尾或尖峰肥尾现象。适度偏态可接受，但若存在大量异常值，可能意味着倾向比估计不稳或样本支持不足。\\n  3) 可将样本随机分为几部分，或使用 bootstrap 重抽样，对每个子样本/重抽样重复计算 EIF 的样本方差并比较其波动，以评估稳定性。\\n\\n- 正交性性质的数值验证设计：\\n  1) 构造两套 bridge 函数估计方案：\\n     - 粗糙估计：使用简单的线性/逻辑回归，仅包含少量主效应，模型偏低维；\\n     - 精细估计：使用更灵活的非参数或机器学习方法（如随机森林、梯度提升、神经网络或高维基函数）以更好逼近真实桥函数。\\n  2) 分别基于两套估计计算 ψ_hat_粗、ψ_hat_精 以及相应的 EIF 序列 EIF_hat_i(粗)、EIF_hat_i(精)，并计算对应的标准误 se_粗、se_精。\\n  3) 预期趋势：\\n     - 若 EIF 构造正确且正交性成立，则在模型不过度错设的前提下，ψ_hat_粗 与 ψ_hat_精 在大样本下应接近同一真值，粗糙模型主要表现为方差较大，而非稳定的系统性偏差。\\n     - 精细估计通常能更好拟合 nuisance，降低 EIF 的样本方差，因此 se_精 通常小于 se_粗，体现效率提升。\\n     - 若粗糙模型造成显著偏差，且该偏差不随样本量增加而减小，则说明桥函数模型严重错设，以致正交性不能弥补一阶偏差，此时需要改进模型或更换方法。', '(6)': '- 构造 EIF 的关键难点：\\n  1) 桥函数可解性与完备性：\\n     - proximal 框架要求存在 h1, h0, q0, q1 使得若干积分方程成立，并且在相应函数空间中是唯一解。这依赖 Z, W 对未观测混杂 U, V 的信息要“足够丰富”，通常形式化为完备性假设。该类假设在应用中难以直接验证，是整个理论的关键且脆弱环节。\\n  2) 反问题与数值不适定性：\\n     - bridge 函数通过逆条件期望算子 T0, T1 定义，本质上是反问题或算子逆问题，可能病态，对噪声和模型设定高度敏感，需要正则化与灵活的非参数方法。\\n  3) 模型错设风险：\\n     - 在有限样本中只能用有限维或机器学习模型近似 bridge 函数，若逼近能力不足或设定不当，可能导致桥方程在样本层面无法近似满足，从而影响 EIF 的无偏性与效率。\\n\\n- 可能导致 bridge 函数不存在或不唯一的情形：\\n  1) 代理变量过弱或无关：\\n     - 若 Z, W 与 U, V 几乎独立或相关性极弱，则无法通过 Z, W 恢复关于 U, V 的足够信息，导致 integral equations 可能无解或多解，bridge 函数不存在或不唯一，EIF_theory(O) 的理论基础随之失效。\\n  2) 条件独立结构不成立：\\n     - proximal mediation 通常依赖结构假设，如给定 (A, M, X, U, V) 时 Z 不再对 Y 有额外影响等。若真实数据生成机制违反这些结构，题设的桥方程本身就不正确，此时任何基于这些方程推导的 EIF 都不再对应目标参数 ψ。\\n  3) 支持或重叠性差：\\n     - 若在某些 (W, X, M) 区域内，仅 A=0 或仅 A=1 出现（缺乏重叠），则 f(A=1|W, X)/f(A=0|W, X) 等比值极不稳定或不可定义，q0, q1 可能无法良好定义或具有无限方差，桥函数的存在性和有限方差性受到破坏。\\n\\n- q0、q1 严重错设对 ψ_hat 与 EIF 性质的影响：\\n  1) q0, q1 直接参与权重与残差校正，如果其估计 q0_hat, q1_hat 严重偏离真实函数：\\n     - bridge 方程在样本中无法近似满足；\\n     - EIF_hat 的样本均值不再接近 0，从而 ψ_hat 失去无偏或一致性；\\n     - EIF 的方差估计基于错误的影响函数，导致标准误和置信区间严重失真，可能过于乐观或悲观。\\n  2) 虽然 canonical EIF 具有对 nuisance 估计误差的一阶正交性，但这种正交性仅在 bridge 函数属于可逼近的正确模型类且估计收敛速度足够快时起作用。若 q0、q1 模型严重错设，则误差不再是“高阶小量”，而是主导项，正交性无法挽救 ψ_hat 的偏差。\\n\\n综上，proximal mediation 下 EIF 的理论构造依赖于代理变量的质量、桥函数的存在与唯一性以及合理的估计方法。一旦这些前提被破坏，canonical EIF 形式 EIF_theory(O) 及其基于 EIF 的推断就可能失效，需要在建模与诊断中给予高度重视。'}",
    "metadata": {
      "subject": "Statistics",
      "topic": "Statistical Analysis",
      "image_path": null,
      "solution_steps": [],
      "tool_expected": [
        "generate_proximal_mediation_data",
        "estimate_all_bridge_functions",
        "estimate_mediation_parameter_psi",
        "compute_eif_components",
        "visualize_eif_distribution",
        "verify_eif_properties",
        "symbolic_eif_derivation",
        "compare_with_standard_answer"
      ],
      "golden_answer": [
        {
          "(1)": "定义指示函数 I(A=a) = 1{A = a}。在题设假设 (i)-(iv) 及 bridge 函数唯一的前提下，ψ = E{Y(A, M(0))} 的 canonical efficient influence function EIF(O) 可写为：\nEIF(O) = -ψ\n          + (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )\n          + ( h1(W, M, 0, X) - h0(W, 0, X) ) · I(A=0)\n          + ( h1(W, M, 1, X) - h0(W, 1, X) ) · I(A=0) · q0(Z, X)\n          + h0(W, A, X)。\n该表达式正是题设所称的标准理论形式 EIF_theory(O)，在真实数据分布下满足 E{EIF(O)} = 0，且为 ψ 在模型 M_sp 的 canonical efficient influence function。",
          "(2)": "- 结构差异：\n  记 EIF_computed(O) 为符号工具给出的候选形式，则两者比较可见：\n  1) 在含残差 (Y - h1(W, M, A, X)) 的部分，两者均为 (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )，仅记号上 I(A,0) 与 I(A=0) 等价，不构成本质差异。\n  2) 在与 h0 与 h1 之差相关的两项上，EIF_theory(O) 采用 (h1(W, M, a, X) - h0(W, a, X)) · I(A=0)（及乘以 q0(Z, X) 的对应项），而 EIF_computed(O) 中相应部分写成 -(h0(W, a, X) - h1(W, M, a, X)) · I(A=0)（以及相应乘 q0(Z, X) 的项）。虽然在代数上 (h1 - h0) = -(h0 - h1)，但若只在局部项改变符号而不整体调整其他项，会改变这些项在 EIF 中的净贡献。\n- 为何 EIF_theory(O) 为 canonical EIF：\n  1) canonical EIF 需满足两个核心性质：\n     - 无偏性：在真实分布与真实 bridge 函数下，E{EIF(O)} = 0；\n     - 正交性与效率：EIF 属于目标参数的影响函数集合，并且是该集合在模型切空间上的投影，因而对所有可容许扰动方向的内积等于参数 ψ 的路径导数，且具有最小方差。\n  2) 在 proximal mediation 中，上述性质依赖 bridge 方程保证若干条件期望为 0，例如\n     - E[ Y − h1(W, M, A, X) | Z, A, M, X ] = 0，\n     - 与 h0、q0、q1 相关的条件期望结合构成对未观测混杂的校正。\n     EIF_theory(O) 正是按这些条件将残差项和桥函数项组合，使整体在真实分布下的期望为 0，并实现对切空间扰动的正确 Riesz 表示。\n  3) 若将 EIF_theory 中 (h1 − h0) 项误改为 (h0 − h1)，而保持其他项不变，则在真实桥函数下，相关项的期望符号会被翻转，从而打破原本精确相消的结构。一般情况下：\n     - 总体期望 E{EIF(O)} 不再为 0，因此该函数不再是 ψ 的影响函数；\n     - 对得分方向的内积不再等于 ψ 的路径导数，失去 canonical 与效率性质。\n  因此，在保持整式其他结构不变的情况下，只有标准形式 EIF_theory(O) 对应的 (h1 − h0) 符号选择才满足影响函数与效率的要求。",
          "(3)": "给出一个具体的模拟机制示例（所有随机变量独立样本复制 n=5000 次，随机种子仅控制伪随机数但不出现在表达式中）：\n- 生成顺序与依赖结构：\n  1) 基线与未观测混杂：\n     - X ~ N(0, 1)，\n     - U ~ N(0, 1)，\n     - V ~ N(0, 1)，\n     假定 (X, U, V) 互相独立。\n  2) 代理变量：令 confounder_strength 通过系数反映在下式中：\n     - Z = c_ZU · U + c_ZV · V + c_ZX · X + ε_Z，ε_Z ~ N(0, 1)，\n     - W = c_WU · U + c_WX · X + ε_W，ε_W ~ N(0, 1)，\n     其中 c_ZU, c_ZV, c_WU 等为固定常数，可选使其数量级反映 confounder_strength = 0.7（例如 c_ZU=0.7, c_ZV=0.7, c_WU=0.7, c_ZX, c_WX 为较小系数）。这样 Z, W 作为 U, V 的 noisy proxy，与未观测混杂有较强线性相关。\n  3) 暴露：\n     - 令 A|W, X ~ Bernoulli( expit(α0 + α1·W + α2·X) )，\n       其中 expit(t)=1/(1+e^{−t})，α0, α1, α2 为固定常数（如 α0=0, α1>0, α2≠0）。这样 W, X 影响暴露，U 通过 W 间接影响 A，体现未观测混杂。\n  4) 中介：\n     - 令 M|A, X, U ~ N( β0 + β1·A + β2·X + β3·U, σ_M^2 )，\n       其中 β0, β1, β2, β3, σ_M 为固定常数，且 β3≠0，使 U 同时影响中介 M。\n  5) 结局：\n     - 令 Y|A, M, X, U, V ~ N( γ0 + γ1·A + γ2·M + γ3·X + γ4·U + γ5·V, σ_Y^2 )，\n       其中 γ0,…,γ5, σ_Y 为固定常数，且 γ4, γ5≠0，使 U, V 通过直接路径影响 Y，从而在 A–Y 和 M–Y 之间制造未观测混杂。\n- proximal 结构与 bridge 函数存在的直观说明：\n  1) 在上述模型中，U, V 同时影响 M 和 Y，导致 A–Y 与 M–Y 关系存在未观测混杂。\n  2) Z, W 通过线性方程从 (U, V, X) 生成，携带关于 U, V 的信息：\n     - W 主要是 U 的 noisy proxy（通过 c_WU），同时依赖 X；\n     - Z 是 (U, V, X) 的混合 noisy proxy（通过 c_ZU, c_ZV, c_ZX）。\n  3) 若进一步假设适当的条件独立结构（例如给定 U, V, A, M, X 时，Z 不再额外影响 Y；给定 U, V, X 时，W 对 A 的影响仅通过暴露机制等），则可以在相应 L2 空间中构造 h1, h0, q0, q1，使它们满足题设的积分方程。直观上：\n     - h1(W, M, A, X) 可被视为用 W 替代 Z 对 Y 的条件期望进行“反演”的函数；\n     - h0(W, A, X) 则通过在 A=0 条件下将 h1 与 Z 的分布联系起来；\n     - q0, q1 通过 W, Z 上的倾向比分解重构 f(A|U, V, X) 的比值关系。\n  4) 由于 W, Z 对 U, V 有连续且非退化的线性依赖，在高斯框架下可满足相应完备性假设，从而保证 bridge 函数存在且唯一。",
          "(4)": "- bridge 函数估计思路：\n  在仅观测 (Y, M, A, Z, W, X) 的前提下，可按如下步骤估计 h1, h0, q0, q1（用帽子表示估计）：\n  1) 倾向分布估计：\n     - 通过 logistic 回归或更灵活的机器学习方法估计 π(W, X) ≈ P(A=1|W, X)，得到 f̂(A=1|W, X) 与 f̂(A=0|W, X)=1−π；\n     - 同理，在 (W, M, X) 上估计 π_M(W, M, X) ≈ P(A=1|W, M, X)，从而得到 f̂(A|W, M, X)。\n  2) 估计 outcome bridge h1：\n     - 利用条件方程 E[Y|Z, A, M, X] = E[h1(W, M, A, X)|Z, A, M, X]；\n     - 实际中可先在 (Z, A, M, X) 空间对 Y 做回归，得到 μ̂_Y(Z, A, M, X) ≈ E[Y|Z, A, M, X]；\n     - 再在 (W, M, A, X) 空间构造一个灵活函数族 h1_hat(·)，通过最小二乘或其他风险最小化，使得 E[h1_hat(W, M, A, X)|Z, A, M, X] 在样本上逼近 μ̂_Y(Z, A, M, X)。\n  3) 估计 outcome bridge h0：\n     - 在 A=0 子样本上使用方程 E[h1(W, M, a, X)|Z, A=0, X] = E[h0(W, a, X)|Z, A=0, X]；\n     - 固定 a∈{0,1}，先利用 h1_hat 计算 μ̂_{h1,a}(Z, X) = E[h1_hat(W, M, a, X)|Z, A=0, X]（通过回归近似）；\n     - 再在 (W, a, X) 空间上拟合 h0_hat(W, a, X)，使得 E[h0_hat(W, a, X)|Z, A=0, X] 在样本上逼近 μ̂_{h1,a}(Z, X)。\n  4) 估计 exposure bridge q0：\n     - 由 f(A=1|W, X)/f(A=0|W, X) = E[q0(Z, X)|W, A=0, X]；\n     - 在 A=0 子样本上，将左端的 odds_hat(W, X) = f̂(A=1|W, X)/f̂(A=0|W, X) 作为“目标”，在 (Z, X) 空间上拟合 q0_hat(Z, X)，使得条件期望 E[q0_hat(Z, X)|W, A=0, X] 逼近 odds_hat(W, X)。\n  5) 估计 exposure bridge q1：\n     - 利用 E[q0(Z, X)|W, A=0, M, X] · { f(A=0|W, M, X)/f(A=1|W, M, X) } = E[q1(Z, M, X)|W, A=1, M, X]；\n     - 用上一步的 q0_hat 和 f̂(A|W, M, X) 构造左端估计，在 A=1 子样本内拟合 q1_hat(Z, M, X)，使其条件期望与左端近似相等。\n\n- ψ 的 plug-in / one-step 估计 ψ_hat：\n  将 canonical EIF 记为\n  EIF(O; ψ, h1, h0, q0, q1) = -ψ + G(O; h1, h0, q0, q1)，\n  其中\n  G(O; h1, h0, q0, q1) = (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )\n                         + ( h1(W, M, 0, X) - h0(W, 0, X) ) · I(A=0)\n                         + ( h1(W, M, 1, X) - h0(W, 1, X) ) · I(A=0) · q0(Z, X)\n                         + h0(W, A, X)。\n  令 h1_hat, h0_hat, q0_hat, q1_hat 为上述估计，用 one-step 校正思想在样本上令 EIF 平均约为 0，有\n  0 ≈ (1/n)∑_{i=1}^n EIF(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)\n    = -ψ_hat + (1/n)∑_{i=1}^n G(O_i; h1_hat, h0_hat, q0_hat, q1_hat)。\n  因此 ψ_hat 的显式样本表达式为\n  ψ_hat = (1/n) ∑_{i=1}^n [ (Y_i - h1_hat(W_i, M_i, A_i, X_i)) · ( I(A_i=0) + I(A_i=1) · q1_hat(Z_i, M_i, X_i) )\n                             + ( h1_hat(W_i, M_i, 0, X_i) - h0_hat(W_i, 0, X_i) ) · I(A_i=0)\n                             + ( h1_hat(W_i, M_i, 1, X_i) - h0_hat(W_i, 1, X_i) ) · I(A_i=0) · q0_hat(Z_i, X_i)\n                             + h0_hat(W_i, A_i, X_i) ]。\n  当 bridge 函数估计足够好时，也可将 G 中的完整结构视为对简单 plug-in 估计（例如 (1/n)∑_i h0_hat(W_i, A_i, X_i)）的一阶校正。\n\n- 标准误与置信区间估计：\n  1) 对每个样本 i 计算估计的 EIF 值：\n     EIF_hat_i = EIF(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)。\n  2) 估计 EIF 的样本方差：\n     - 可取中心化形式 s^2 = (1/(n-1))∑_{i=1}^n (EIF_hat_i - EIF_bar)^2，EIF_bar = (1/n)∑_i EIF_hat_i；\n     - 或在理论上 E{EIF}=0 的前提下，用 (1/n)∑_i EIF_hat_i^2 近似其二阶矩。\n  3) ψ_hat 的标准误估计为 se_hat = sqrt( s^2 / n )。\n  4) 在大样本下，利用正态近似构造 95% 置信区间：\n     CI_95 = [ ψ_hat − z_{0.975} · se_hat, ψ_hat + z_{0.975} · se_hat ]，其中 z_{0.975} 为标准正态分位数。",
          "(5)": "- EIF 零均值性检验：\n  1) 在 n=5000 的样本上，用估计的 bridge 函数计算 EIF_hat_i = EIF_theory(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)。\n  2) 计算样本平均 μ_hat = (1/n)∑_{i=1}^n EIF_hat_i 和样本方差 s^2 = (1/(n-1))∑_{i=1}^n (EIF_hat_i - μ_hat)^2。\n  3) 构造 t 统计量 t = μ_hat / sqrt(s^2/n)。在 EIF 正确且 bridge 函数估计良好的情况下，t 在大样本下应接近 0，近似服从标准正态分布。若 |t| 较小（例如小于常用临界值），支持 E{EIF(O)} = 0；若偏离明显，则可能指示 EIF 公式或桥函数估计存在问题。\n\n- 有限方差与稳定性检验：\n  1) 计算 EIF_hat_i 的样本方差 s^2，检查是否处于合理范围，以排除极端爆炸或数值不稳定。\n  2) 绘制 EIF_hat_i 的直方图与核密度估计，观察其分布是否存在极端长尾或尖峰肥尾现象。适度偏态可接受，但若存在大量异常值，可能意味着倾向比估计不稳或样本支持不足。\n  3) 可将样本随机分为几部分，或使用 bootstrap 重抽样，对每个子样本/重抽样重复计算 EIF 的样本方差并比较其波动，以评估稳定性。\n\n- 正交性性质的数值验证设计：\n  1) 构造两套 bridge 函数估计方案：\n     - 粗糙估计：使用简单的线性/逻辑回归，仅包含少量主效应，模型偏低维；\n     - 精细估计：使用更灵活的非参数或机器学习方法（如随机森林、梯度提升、神经网络或高维基函数）以更好逼近真实桥函数。\n  2) 分别基于两套估计计算 ψ_hat_粗、ψ_hat_精 以及相应的 EIF 序列 EIF_hat_i(粗)、EIF_hat_i(精)，并计算对应的标准误 se_粗、se_精。\n  3) 预期趋势：\n     - 若 EIF 构造正确且正交性成立，则在模型不过度错设的前提下，ψ_hat_粗 与 ψ_hat_精 在大样本下应接近同一真值，粗糙模型主要表现为方差较大，而非稳定的系统性偏差。\n     - 精细估计通常能更好拟合 nuisance，降低 EIF 的样本方差，因此 se_精 通常小于 se_粗，体现效率提升。\n     - 若粗糙模型造成显著偏差，且该偏差不随样本量增加而减小，则说明桥函数模型严重错设，以致正交性不能弥补一阶偏差，此时需要改进模型或更换方法。",
          "(6)": "- 构造 EIF 的关键难点：\n  1) 桥函数可解性与完备性：\n     - proximal 框架要求存在 h1, h0, q0, q1 使得若干积分方程成立，并且在相应函数空间中是唯一解。这依赖 Z, W 对未观测混杂 U, V 的信息要“足够丰富”，通常形式化为完备性假设。该类假设在应用中难以直接验证，是整个理论的关键且脆弱环节。\n  2) 反问题与数值不适定性：\n     - bridge 函数通过逆条件期望算子 T0, T1 定义，本质上是反问题或算子逆问题，可能病态，对噪声和模型设定高度敏感，需要正则化与灵活的非参数方法。\n  3) 模型错设风险：\n     - 在有限样本中只能用有限维或机器学习模型近似 bridge 函数，若逼近能力不足或设定不当，可能导致桥方程在样本层面无法近似满足，从而影响 EIF 的无偏性与效率。\n\n- 可能导致 bridge 函数不存在或不唯一的情形：\n  1) 代理变量过弱或无关：\n     - 若 Z, W 与 U, V 几乎独立或相关性极弱，则无法通过 Z, W 恢复关于 U, V 的足够信息，导致 integral equations 可能无解或多解，bridge 函数不存在或不唯一，EIF_theory(O) 的理论基础随之失效。\n  2) 条件独立结构不成立：\n     - proximal mediation 通常依赖结构假设，如给定 (A, M, X, U, V) 时 Z 不再对 Y 有额外影响等。若真实数据生成机制违反这些结构，题设的桥方程本身就不正确，此时任何基于这些方程推导的 EIF 都不再对应目标参数 ψ。\n  3) 支持或重叠性差：\n     - 若在某些 (W, X, M) 区域内，仅 A=0 或仅 A=1 出现（缺乏重叠），则 f(A=1|W, X)/f(A=0|W, X) 等比值极不稳定或不可定义，q0, q1 可能无法良好定义或具有无限方差，桥函数的存在性和有限方差性受到破坏。\n\n- q0、q1 严重错设对 ψ_hat 与 EIF 性质的影响：\n  1) q0, q1 直接参与权重与残差校正，如果其估计 q0_hat, q1_hat 严重偏离真实函数：\n     - bridge 方程在样本中无法近似满足；\n     - EIF_hat 的样本均值不再接近 0，从而 ψ_hat 失去无偏或一致性；\n     - EIF 的方差估计基于错误的影响函数，导致标准误和置信区间严重失真，可能过于乐观或悲观。\n  2) 虽然 canonical EIF 具有对 nuisance 估计误差的一阶正交性，但这种正交性仅在 bridge 函数属于可逼近的正确模型类且估计收敛速度足够快时起作用。若 q0、q1 模型严重错设，则误差不再是“高阶小量”，而是主导项，正交性无法挽救 ψ_hat 的偏差。\n\n综上，proximal mediation 下 EIF 的理论构造依赖于代理变量的质量、桥函数的存在与唯一性以及合理的估计方法。一旦这些前提被破坏，canonical EIF 形式 EIF_theory(O) 及其基于 EIF 的推断就可能失效，需要在建模与诊断中给予高度重视。"
        }
      ],
      "original_question_id": "35",
      "test_type": "refined",
      "dataset_key": "merged_questions_augmented",
      "trace_root": "/Users/yangyajie/Desktop/code/Toolkit/tracetoanalyze/traces",
      "_dataset_filename": "refine_merged_single_questions.json"
    },
    "usage_tool_protocol": [
      {
        "type": "function",
        "function": {
          "name": "generate_proximal_mediation_data",
          "description": "生成符合proximal mediation设定的模拟数据",
          "strict": true,
          "parameters": {
            "type": "object",
            "properties": {
              "n_samples": {
                "type": "integer",
                "description": "样本量"
              },
              "seed": {
                "type": "integer",
                "description": "随机种子"
              },
              "confounder_strength": {
                "type": "number",
                "description": "未观测混杂因子的影响强度"
              }
            },
            "required": [
              "n_samples"
            ]
          }
        },
        "additionalProperties": {
          "function_path": "./tools/proximal_mediation_eif_toolkit_claude_5.py",
          "resolved_file_path": "toolkits/statistics/statistical_analysis/proximal_mediation_eif_toolkit_claude_5.py",
          "resolved_dir": "toolkits/statistics/statistical_analysis"
        }
      },
      {
        "type": "function",
        "function": {
          "name": "estimate_all_bridge_functions",
          "description": "估计所有bridge函数: h1, h0, q0, q1",
          "strict": true,
          "parameters": {
            "type": "object",
            "properties": {
              "data": {
                "type": "object",
                "description": "包含Y, M, A, Z, W, X的数据字典"
              },
              "regularization": {
                "type": "number",
                "description": "正则化参数"
              }
            },
            "required": [
              "data"
            ]
          }
        },
        "additionalProperties": {
          "function_path": "./tools/proximal_mediation_eif_toolkit_claude_5.py"
        }
      },
      {
        "type": "function",
        "function": {
          "name": "compute_eif_components",
          "description": "计算EIF的各个组成部分",
          "strict": true,
          "parameters": {
            "type": "object",
            "properties": {
              "data": {
                "type": "object",
                "description": "观测数据"
              },
              "bridge_funcs": {
                "type": "object",
                "description": "所有bridge函数"
              },
              "psi_value": {
                "type": "number",
                "description": "目标参数ψ的估计值"
              }
            },
            "required": [
              "data",
              "bridge_funcs",
              "psi_value"
            ]
          }
        },
        "additionalProperties": {
          "function_path": "./tools/proximal_mediation_eif_toolkit_claude_5.py"
        }
      },
      {
        "type": "function",
        "function": {
          "name": "estimate_mediation_parameter_psi",
          "description": "估计中介参数 ψ = E[Y(A,M(0))]，使用h0函数的期望",
          "strict": true,
          "parameters": {
            "type": "object",
            "properties": {
              "data": {
                "type": "object",
                "description": "观测数据"
              },
              "bridge_funcs": {
                "type": "object",
                "description": "所有bridge函数"
              }
            },
            "required": [
              "data",
              "bridge_funcs"
            ]
          }
        },
        "additionalProperties": {
          "function_path": "./tools/proximal_mediation_eif_toolkit_claude_5.py"
        }
      },
      {
        "type": "function",
        "function": {
          "name": "visualize_eif_distribution",
          "description": "可视化EIF及其各组成部分的分布",
          "strict": true,
          "parameters": {
            "type": "object",
            "properties": {
              "eif_components": {
                "type": "object",
                "description": "EIF各项的计算结果"
              },
              "save_path": {
                "type": "string",
                "description": "图像保存路径"
              }
            },
            "required": [
              "eif_components"
            ]
          }
        },
        "additionalProperties": {
          "function_path": "./tools/proximal_mediation_eif_toolkit_claude_5.py"
        }
      },
      {
        "type": "function",
        "function": {
          "name": "verify_eif_properties",
          "description": "验证EIF的理论性质：1. 零均值性: E[EIF] ≈ 0；2. 正交性: EIF与nuisance参数的score正交；3. 方差有限性",
          "strict": true,
          "parameters": {
            "type": "object",
            "properties": {
              "eif_components": {
                "type": "object",
                "description": "EIF各项"
              },
              "data": {
                "type": "object",
                "description": "原始数据"
              }
            },
            "required": [
              "eif_components",
              "data"
            ]
          }
        },
        "additionalProperties": {
          "function_path": "./tools/proximal_mediation_eif_toolkit_claude_5.py"
        }
      },
      {
        "type": "function",
        "function": {
          "name": "symbolic_eif_derivation",
          "description": "使用sympy进行EIF的符号推导，展示理论公式",
          "strict": true,
          "parameters": {
            "type": "object",
            "properties": {},
            "required": []
          }
        },
        "additionalProperties": {
          "function_path": "./tools/proximal_mediation_eif_toolkit_claude_5.py"
        }
      },
      {
        "type": "function",
        "function": {
          "name": "compare_with_standard_answer",
          "description": "比较计算得到的EIF公式与标准答案",
          "strict": true,
          "parameters": {
            "type": "object",
            "properties": {
              "computed_eif_formula": {
                "type": "string",
                "description": "计算得到的EIF公式(字符串)"
              },
              "standard_answer": {
                "type": "string",
                "description": "标准答案公式"
              }
            },
            "required": [
              "computed_eif_formula",
              "standard_answer"
            ]
          }
        },
        "additionalProperties": {
          "function_path": "./tools/proximal_mediation_eif_toolkit_claude_5.py"
        }
      }
    ],
    "refined_version_data": {
      "refined_question": "设观测数据 O = (Y, M, A, Z, W, X) 从半参数模型 M_sp 中独立同分布产生。暴露 A∈{0,1}，中介 M∈R，结局 Y∈R，存在未观测混杂 U, V，它们由代理变量 Z, W 及基线协变量 X 部分反映。关注参数为\nψ = E{ Y(A, M(0)) }，即将暴露固定为个体实际取值 A，而中介固定为在 A=0 下的潜在值 M(0) 时的平均结局。\n\n在 proximal mediation 框架下，假设存在如下 bridge 函数：\n- outcome bridge 函数 h1(w, m, a, x) 与 h0(w, a, x)，对所有 a∈{0,1} 满足\n  1) E[ Y | Z, A, M, X ] = ∫ h1(w, M, A, X) dF(w | Z, A, M, X)，\n  2) E[ h1(W, M, a, X) | Z, A=0, X ] = ∫ h0(w, a, X) dF(w | Z, A=0, X)。\n- exposure bridge 函数 q0(z, x) 与 q1(z, m, x)，满足\n  3) f(A=1 | W, X)/f(A=0 | W, X) = E[ q0(Z, X) | W, A=0, X ]，\n  4) E[ q0(Z, X) | W, A=0, M, X ] · { f(A=0 | W, M, X)/f(A=1 | W, M, X) } = E[ q1(Z, M, X) | W, A=1, M, X ]。\n并假设：\n(i) 上述积分方程在真实分布下可解；\n(ii) 满足必要的完备性条件，使解唯一；\n(iii) 条件期望算子 T1: g→E[g(W,M,A,X)|Z,A,M,X] 与 T0: g→E[g(W,M,X)|Z,A=0,X] 在相应 L2 空间为满射；\n(iv) 在真实分布下所有 bridge 函数均存在且唯一。\n\n记 I(A=a) 为指示函数 1{A=a}。已知某符号推导工具给出一个候选影响函数 EIF_computed(O)，同时标准理论给出 canonical efficient influence function EIF_theory(O) 的一个具体解析形式，但不在此直接给出。\n\n在此背景下，回答下列问题（所有结果均以符号表达式形式给出）：\n\n(1) 在假设 (i)-(iv) 成立且 bridge 函数唯一的前提下，用 Y, M, A, Z, W, X, ψ 以及 h1, h0, q0, q1 和指示函数 I(A=a) 写出 ψ 在模型 M_sp 中的 canonical efficient influence function EIF(O) 的一个完整解析表达式。并说明该表达式与标准理论 EIF_theory(O) 的对应关系（不要求推导过程）。\n\n(2) 将候选 EIF_computed(O) 与标准 EIF_theory(O) 的结构进行比较，指出：\n   - 二者在哪些具体项上存在符号或形式差异（特别是涉及 h1 与 h0 之差的项）；\n   - 解释为何 EIF_theory(O) 才是 canonical EIF（可从 EIF 需满足零均值和对可容许干扰方向正交等性质进行讨论），并说明若将 EIF_theory 中涉及 (h1 − h0) 的项误写为 (h0 − h1)，一般会导致怎样的偏差或失效（例如不再满足零均值性）。\n\n(3) 在样本量 n=5000、随机种子 seed=123、confounder_strength=0.7 的设定下，给出一个合理的、具体的模拟数据生成机制示例（不要求与任何工具内部实现完全一致），说明：\n   - U, V, X, Z, W, A, M, Y 的生成顺序及条件依赖结构，使之体现 proximal mediation 的思想（即 U, V 同时影响中介和结局，而 Z, W 作为 U, V 的代理，与 A, M, Y 相关）；\n   - 写出一套明确的概率生成方程（可以是高斯线性模型或 logistic/Bernoulli 模型形式，如 A|W,X 为 Bernoulli(expit(…)) 等），参数可自拟但须固定；\n   - 说明在这种生成模型下，为何存在满足题干条件的 bridge 函数（可用直观论述，无需给出显式形式）。\n\n(4) 在只观测到 (Y, M, A, Z, W, X) 的前提下，回答：\n   - 如何基于样本理论上估计 h1, h0, q0, q1，例如通过一系列回归或最小二乘近似地求解上述积分方程；\n   - 在给出 h1_hat, h0_hat, q0_hat, q1_hat 的基础上，写出 ψ 的一个 plug-in（或 one-step）估计 ψ_hat 的显式样本表达式，要求直接用样本平均形式表示，且与 canonical EIF 的结构保持一致；\n   - 说明如何利用样本 EIF 构造 ψ_hat 的标准误和置信区间的估计方法（例如基于 EIF 的样本方差）。\n\n(5) 假设已经基于生成数据估计得到了 bridge 函数，并据此可在每个样本点上计算 EIF_theory(O_i) 的数值。设计一个理论上的数值验证方案，说明：\n   - 如何检验 EIF 的零均值性（给出基于样本平均和标准误的检验步骤或统计量构造思路）；\n   - 如何检验 EIF 的有限方差与数值稳定性（如通过样本方差、直方图或核密度估计等手段）；\n   - 如何利用 EIF 的正交性性质设计数值实验：例如比较“粗糙”估计与“精细”估计 bridge 函数时得到的 ψ_hat 的偏差与方差表现，应呈现怎样的趋势以符合正交性预期。\n\n(6) 基于上述讨论，总结：\n   - 在 proximal mediation 框架下构造 ψ 的 EIF 的关键难点（例如 bridge 方程可解性、完备性条件、模型错设风险等）；\n   - 在哪些情形下，bridge 函数可能不存在或不唯一，从而 canonical EIF 失效（例如代理 W, Z 太弱或条件独立结构不成立）；\n   - 若 q0 或 q1 的估计模型严重错设，将对 ψ_hat 及基于 EIF 的性质（如一致性、零均值性、方差估计准确性）造成怎样的影响。\n\n所有小问的结果要求以符号表达式或关系式及定性文字说明给出，不要求且不得给出任何数值计算结果。",
      "final_answer": {
        "(1)": "定义指示函数 I(A=a) = 1{A = a}。在题设假设 (i)-(iv) 及 bridge 函数唯一的前提下，ψ = E{Y(A, M(0))} 的 canonical efficient influence function EIF(O) 可写为：\nEIF(O) = -ψ\n          + (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )\n          + ( h1(W, M, 0, X) - h0(W, 0, X) ) · I(A=0)\n          + ( h1(W, M, 1, X) - h0(W, 1, X) ) · I(A=0) · q0(Z, X)\n          + h0(W, A, X)。\n该表达式正是题设所称的标准理论形式 EIF_theory(O)，在真实数据分布下满足 E{EIF(O)} = 0，且为 ψ 在模型 M_sp 的 canonical efficient influence function。",
        "(2)": "- 结构差异：\n  记 EIF_computed(O) 为符号工具给出的候选形式，则两者比较可见：\n  1) 在含残差 (Y - h1(W, M, A, X)) 的部分，两者均为 (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )，仅记号上 I(A,0) 与 I(A=0) 等价，不构成本质差异。\n  2) 在与 h0 与 h1 之差相关的两项上，EIF_theory(O) 采用 (h1(W, M, a, X) - h0(W, a, X)) · I(A=0)（及乘以 q0(Z, X) 的对应项），而 EIF_computed(O) 中相应部分写成 -(h0(W, a, X) - h1(W, M, a, X)) · I(A=0)（以及相应乘 q0(Z, X) 的项）。虽然在代数上 (h1 - h0) = -(h0 - h1)，但若只在局部项改变符号而不整体调整其他项，会改变这些项在 EIF 中的净贡献。\n- 为何 EIF_theory(O) 为 canonical EIF：\n  1) canonical EIF 需满足两个核心性质：\n     - 无偏性：在真实分布与真实 bridge 函数下，E{EIF(O)} = 0；\n     - 正交性与效率：EIF 属于目标参数的影响函数集合，并且是该集合在模型切空间上的投影，因而对所有可容许扰动方向的内积等于参数 ψ 的路径导数，且具有最小方差。\n  2) 在 proximal mediation 中，上述性质依赖 bridge 方程保证若干条件期望为 0，例如\n     - E[ Y − h1(W, M, A, X) | Z, A, M, X ] = 0，\n     - 与 h0、q0、q1 相关的条件期望结合构成对未观测混杂的校正。\n     EIF_theory(O) 正是按这些条件将残差项和桥函数项组合，使整体在真实分布下的期望为 0，并实现对切空间扰动的正确 Riesz 表示。\n  3) 若将 EIF_theory 中 (h1 − h0) 项误改为 (h0 − h1)，而保持其他项不变，则在真实桥函数下，相关项的期望符号会被翻转，从而打破原本精确相消的结构。一般情况下：\n     - 总体期望 E{EIF(O)} 不再为 0，因此该函数不再是 ψ 的影响函数；\n     - 对得分方向的内积不再等于 ψ 的路径导数，失去 canonical 与效率性质。\n  因此，在保持整式其他结构不变的情况下，只有标准形式 EIF_theory(O) 对应的 (h1 − h0) 符号选择才满足影响函数与效率的要求。",
        "(3)": "给出一个具体的模拟机制示例（所有随机变量独立样本复制 n=5000 次，随机种子仅控制伪随机数但不出现在表达式中）：\n- 生成顺序与依赖结构：\n  1) 基线与未观测混杂：\n     - X ~ N(0, 1)，\n     - U ~ N(0, 1)，\n     - V ~ N(0, 1)，\n     假定 (X, U, V) 互相独立。\n  2) 代理变量：令 confounder_strength 通过系数反映在下式中：\n     - Z = c_ZU · U + c_ZV · V + c_ZX · X + ε_Z，ε_Z ~ N(0, 1)，\n     - W = c_WU · U + c_WX · X + ε_W，ε_W ~ N(0, 1)，\n     其中 c_ZU, c_ZV, c_WU 等为固定常数，可选使其数量级反映 confounder_strength = 0.7（例如 c_ZU=0.7, c_ZV=0.7, c_WU=0.7, c_ZX, c_WX 为较小系数）。这样 Z, W 作为 U, V 的 noisy proxy，与未观测混杂有较强线性相关。\n  3) 暴露：\n     - 令 A|W, X ~ Bernoulli( expit(α0 + α1·W + α2·X) )，\n       其中 expit(t)=1/(1+e^{−t})，α0, α1, α2 为固定常数（如 α0=0, α1>0, α2≠0）。这样 W, X 影响暴露，U 通过 W 间接影响 A，体现未观测混杂。\n  4) 中介：\n     - 令 M|A, X, U ~ N( β0 + β1·A + β2·X + β3·U, σ_M^2 )，\n       其中 β0, β1, β2, β3, σ_M 为固定常数，且 β3≠0，使 U 同时影响中介 M。\n  5) 结局：\n     - 令 Y|A, M, X, U, V ~ N( γ0 + γ1·A + γ2·M + γ3·X + γ4·U + γ5·V, σ_Y^2 )，\n       其中 γ0,…,γ5, σ_Y 为固定常数，且 γ4, γ5≠0，使 U, V 通过直接路径影响 Y，从而在 A–Y 和 M–Y 之间制造未观测混杂。\n- proximal 结构与 bridge 函数存在的直观说明：\n  1) 在上述模型中，U, V 同时影响 M 和 Y，导致 A–Y 与 M–Y 关系存在未观测混杂。\n  2) Z, W 通过线性方程从 (U, V, X) 生成，携带关于 U, V 的信息：\n     - W 主要是 U 的 noisy proxy（通过 c_WU），同时依赖 X；\n     - Z 是 (U, V, X) 的混合 noisy proxy（通过 c_ZU, c_ZV, c_ZX）。\n  3) 若进一步假设适当的条件独立结构（例如给定 U, V, A, M, X 时，Z 不再额外影响 Y；给定 U, V, X 时，W 对 A 的影响仅通过暴露机制等），则可以在相应 L2 空间中构造 h1, h0, q0, q1，使它们满足题设的积分方程。直观上：\n     - h1(W, M, A, X) 可被视为用 W 替代 Z 对 Y 的条件期望进行“反演”的函数；\n     - h0(W, A, X) 则通过在 A=0 条件下将 h1 与 Z 的分布联系起来；\n     - q0, q1 通过 W, Z 上的倾向比分解重构 f(A|U, V, X) 的比值关系。\n  4) 由于 W, Z 对 U, V 有连续且非退化的线性依赖，在高斯框架下可满足相应完备性假设，从而保证 bridge 函数存在且唯一。",
        "(4)": "- bridge 函数估计思路：\n  在仅观测 (Y, M, A, Z, W, X) 的前提下，可按如下步骤估计 h1, h0, q0, q1（用帽子表示估计）：\n  1) 倾向分布估计：\n     - 通过 logistic 回归或更灵活的机器学习方法估计 π(W, X) ≈ P(A=1|W, X)，得到 f̂(A=1|W, X) 与 f̂(A=0|W, X)=1−π；\n     - 同理，在 (W, M, X) 上估计 π_M(W, M, X) ≈ P(A=1|W, M, X)，从而得到 f̂(A|W, M, X)。\n  2) 估计 outcome bridge h1：\n     - 利用条件方程 E[Y|Z, A, M, X] = E[h1(W, M, A, X)|Z, A, M, X]；\n     - 实际中可先在 (Z, A, M, X) 空间对 Y 做回归，得到 μ̂_Y(Z, A, M, X) ≈ E[Y|Z, A, M, X]；\n     - 再在 (W, M, A, X) 空间构造一个灵活函数族 h1_hat(·)，通过最小二乘或其他风险最小化，使得 E[h1_hat(W, M, A, X)|Z, A, M, X] 在样本上逼近 μ̂_Y(Z, A, M, X)。\n  3) 估计 outcome bridge h0：\n     - 在 A=0 子样本上使用方程 E[h1(W, M, a, X)|Z, A=0, X] = E[h0(W, a, X)|Z, A=0, X]；\n     - 固定 a∈{0,1}，先利用 h1_hat 计算 μ̂_{h1,a}(Z, X) = E[h1_hat(W, M, a, X)|Z, A=0, X]（通过回归近似）；\n     - 再在 (W, a, X) 空间上拟合 h0_hat(W, a, X)，使得 E[h0_hat(W, a, X)|Z, A=0, X] 在样本上逼近 μ̂_{h1,a}(Z, X)。\n  4) 估计 exposure bridge q0：\n     - 由 f(A=1|W, X)/f(A=0|W, X) = E[q0(Z, X)|W, A=0, X]；\n     - 在 A=0 子样本上，将左端的 odds_hat(W, X) = f̂(A=1|W, X)/f̂(A=0|W, X) 作为“目标”，在 (Z, X) 空间上拟合 q0_hat(Z, X)，使得条件期望 E[q0_hat(Z, X)|W, A=0, X] 逼近 odds_hat(W, X)。\n  5) 估计 exposure bridge q1：\n     - 利用 E[q0(Z, X)|W, A=0, M, X] · { f(A=0|W, M, X)/f(A=1|W, M, X) } = E[q1(Z, M, X)|W, A=1, M, X]；\n     - 用上一步的 q0_hat 和 f̂(A|W, M, X) 构造左端估计，在 A=1 子样本内拟合 q1_hat(Z, M, X)，使其条件期望与左端近似相等。\n\n- ψ 的 plug-in / one-step 估计 ψ_hat：\n  将 canonical EIF 记为\n  EIF(O; ψ, h1, h0, q0, q1) = -ψ + G(O; h1, h0, q0, q1)，\n  其中\n  G(O; h1, h0, q0, q1) = (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )\n                         + ( h1(W, M, 0, X) - h0(W, 0, X) ) · I(A=0)\n                         + ( h1(W, M, 1, X) - h0(W, 1, X) ) · I(A=0) · q0(Z, X)\n                         + h0(W, A, X)。\n  令 h1_hat, h0_hat, q0_hat, q1_hat 为上述估计，用 one-step 校正思想在样本上令 EIF 平均约为 0，有\n  0 ≈ (1/n)∑_{i=1}^n EIF(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)\n    = -ψ_hat + (1/n)∑_{i=1}^n G(O_i; h1_hat, h0_hat, q0_hat, q1_hat)。\n  因此 ψ_hat 的显式样本表达式为\n  ψ_hat = (1/n) ∑_{i=1}^n [ (Y_i - h1_hat(W_i, M_i, A_i, X_i)) · ( I(A_i=0) + I(A_i=1) · q1_hat(Z_i, M_i, X_i) )\n                             + ( h1_hat(W_i, M_i, 0, X_i) - h0_hat(W_i, 0, X_i) ) · I(A_i=0)\n                             + ( h1_hat(W_i, M_i, 1, X_i) - h0_hat(W_i, 1, X_i) ) · I(A_i=0) · q0_hat(Z_i, X_i)\n                             + h0_hat(W_i, A_i, X_i) ]。\n  当 bridge 函数估计足够好时，也可将 G 中的完整结构视为对简单 plug-in 估计（例如 (1/n)∑_i h0_hat(W_i, A_i, X_i)）的一阶校正。\n\n- 标准误与置信区间估计：\n  1) 对每个样本 i 计算估计的 EIF 值：\n     EIF_hat_i = EIF(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)。\n  2) 估计 EIF 的样本方差：\n     - 可取中心化形式 s^2 = (1/(n-1))∑_{i=1}^n (EIF_hat_i - EIF_bar)^2，EIF_bar = (1/n)∑_i EIF_hat_i；\n     - 或在理论上 E{EIF}=0 的前提下，用 (1/n)∑_i EIF_hat_i^2 近似其二阶矩。\n  3) ψ_hat 的标准误估计为 se_hat = sqrt( s^2 / n )。\n  4) 在大样本下，利用正态近似构造 95% 置信区间：\n     CI_95 = [ ψ_hat − z_{0.975} · se_hat, ψ_hat + z_{0.975} · se_hat ]，其中 z_{0.975} 为标准正态分位数。",
        "(5)": "- EIF 零均值性检验：\n  1) 在 n=5000 的样本上，用估计的 bridge 函数计算 EIF_hat_i = EIF_theory(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)。\n  2) 计算样本平均 μ_hat = (1/n)∑_{i=1}^n EIF_hat_i 和样本方差 s^2 = (1/(n-1))∑_{i=1}^n (EIF_hat_i - μ_hat)^2。\n  3) 构造 t 统计量 t = μ_hat / sqrt(s^2/n)。在 EIF 正确且 bridge 函数估计良好的情况下，t 在大样本下应接近 0，近似服从标准正态分布。若 |t| 较小（例如小于常用临界值），支持 E{EIF(O)} = 0；若偏离明显，则可能指示 EIF 公式或桥函数估计存在问题。\n\n- 有限方差与稳定性检验：\n  1) 计算 EIF_hat_i 的样本方差 s^2，检查是否处于合理范围，以排除极端爆炸或数值不稳定。\n  2) 绘制 EIF_hat_i 的直方图与核密度估计，观察其分布是否存在极端长尾或尖峰肥尾现象。适度偏态可接受，但若存在大量异常值，可能意味着倾向比估计不稳或样本支持不足。\n  3) 可将样本随机分为几部分，或使用 bootstrap 重抽样，对每个子样本/重抽样重复计算 EIF 的样本方差并比较其波动，以评估稳定性。\n\n- 正交性性质的数值验证设计：\n  1) 构造两套 bridge 函数估计方案：\n     - 粗糙估计：使用简单的线性/逻辑回归，仅包含少量主效应，模型偏低维；\n     - 精细估计：使用更灵活的非参数或机器学习方法（如随机森林、梯度提升、神经网络或高维基函数）以更好逼近真实桥函数。\n  2) 分别基于两套估计计算 ψ_hat_粗、ψ_hat_精 以及相应的 EIF 序列 EIF_hat_i(粗)、EIF_hat_i(精)，并计算对应的标准误 se_粗、se_精。\n  3) 预期趋势：\n     - 若 EIF 构造正确且正交性成立，则在模型不过度错设的前提下，ψ_hat_粗 与 ψ_hat_精 在大样本下应接近同一真值，粗糙模型主要表现为方差较大，而非稳定的系统性偏差。\n     - 精细估计通常能更好拟合 nuisance，降低 EIF 的样本方差，因此 se_精 通常小于 se_粗，体现效率提升。\n     - 若粗糙模型造成显著偏差，且该偏差不随样本量增加而减小，则说明桥函数模型严重错设，以致正交性不能弥补一阶偏差，此时需要改进模型或更换方法。",
        "(6)": "- 构造 EIF 的关键难点：\n  1) 桥函数可解性与完备性：\n     - proximal 框架要求存在 h1, h0, q0, q1 使得若干积分方程成立，并且在相应函数空间中是唯一解。这依赖 Z, W 对未观测混杂 U, V 的信息要“足够丰富”，通常形式化为完备性假设。该类假设在应用中难以直接验证，是整个理论的关键且脆弱环节。\n  2) 反问题与数值不适定性：\n     - bridge 函数通过逆条件期望算子 T0, T1 定义，本质上是反问题或算子逆问题，可能病态，对噪声和模型设定高度敏感，需要正则化与灵活的非参数方法。\n  3) 模型错设风险：\n     - 在有限样本中只能用有限维或机器学习模型近似 bridge 函数，若逼近能力不足或设定不当，可能导致桥方程在样本层面无法近似满足，从而影响 EIF 的无偏性与效率。\n\n- 可能导致 bridge 函数不存在或不唯一的情形：\n  1) 代理变量过弱或无关：\n     - 若 Z, W 与 U, V 几乎独立或相关性极弱，则无法通过 Z, W 恢复关于 U, V 的足够信息，导致 integral equations 可能无解或多解，bridge 函数不存在或不唯一，EIF_theory(O) 的理论基础随之失效。\n  2) 条件独立结构不成立：\n     - proximal mediation 通常依赖结构假设，如给定 (A, M, X, U, V) 时 Z 不再对 Y 有额外影响等。若真实数据生成机制违反这些结构，题设的桥方程本身就不正确，此时任何基于这些方程推导的 EIF 都不再对应目标参数 ψ。\n  3) 支持或重叠性差：\n     - 若在某些 (W, X, M) 区域内，仅 A=0 或仅 A=1 出现（缺乏重叠），则 f(A=1|W, X)/f(A=0|W, X) 等比值极不稳定或不可定义，q0, q1 可能无法良好定义或具有无限方差，桥函数的存在性和有限方差性受到破坏。\n\n- q0、q1 严重错设对 ψ_hat 与 EIF 性质的影响：\n  1) q0, q1 直接参与权重与残差校正，如果其估计 q0_hat, q1_hat 严重偏离真实函数：\n     - bridge 方程在样本中无法近似满足；\n     - EIF_hat 的样本均值不再接近 0，从而 ψ_hat 失去无偏或一致性；\n     - EIF 的方差估计基于错误的影响函数，导致标准误和置信区间严重失真，可能过于乐观或悲观。\n  2) 虽然 canonical EIF 具有对 nuisance 估计误差的一阶正交性，但这种正交性仅在 bridge 函数属于可逼近的正确模型类且估计收敛速度足够快时起作用。若 q0、q1 模型严重错设，则误差不再是“高阶小量”，而是主导项，正交性无法挽救 ψ_hat 的偏差。\n\n综上，proximal mediation 下 EIF 的理论构造依赖于代理变量的质量、桥函数的存在与唯一性以及合理的估计方法。一旦这些前提被破坏，canonical EIF 形式 EIF_theory(O) 及其基于 EIF 的推断就可能失效，需要在建模与诊断中给予高度重视。"
      }
    },
    "metadata_summary": {
      "subject": "Statistics",
      "topic": "Statistical Analysis",
      "test_type": "refined",
      "original_question_id": "35",
      "subject_topic_key": "Statistics::Statistical Analysis"
    }
  },
  "model": "glm-4.6v",
  "use_tools": true,
  "mode": "tool_mode",
  "rounds": 1,
  "messages": [
    {
      "role": "system",
      "content": "你是一个顶尖的 AI 科学助手，你的任务是解决来自物理、化学、生物等领域的复杂、多模态、多步骤问题。\n\n# 任务指令：两阶段方法\n\n你必须严格遵循以下两个阶段来回答问题：\n\n**阶段 1: 规划 (Planning)**\n在开始执行任何操作之前，你必须首先生成一个高阶的、分步骤的“计划”。这个计划应该概述你打算如何分解问题、使用哪些工具、以及工具之间的依赖关系。\n\n**阶段 2: 执行 (Execution)**\n在提交计划后，你将开始逐一执行。你必须严格遵循以下的 \"ReAct\" 格式 (Thought, Action, Observation)，直到你得出最终答案。\n\n---\n\n**输出格式规范**\n\n**[阶段 1: 规划]**\nPlan:\n\n1. [你的计划步骤 1，例如：分析输入图像中的分子结构]\n2. [你的计划步骤 2，例如：使用 `analyze_molecule` 工具获取 SMILES]\n3. [你的计划步骤 3，例如：将 SMILES 传入 `calculate_properties` 工具]\n4. ...\n5. [你的计划步骤 N，例如：总结所有属性并回答问题]\n\n**[阶段 2: 执行]**\nThought: [描述你当前的思考，你正处于计划的第几步，以及你为什么需要调用这个特定的工具。]\nAction: 请你在这一步发出工具调用\n\n[在你提交 Action 后，你将收到一个 Observation]\n\nObservation: [这里将由评测系统插入工具的返回结果]\n\n[然后你重复这个循环]\n\nThought: [基于上一步的 Observation，你的新思考。]\nAction: 请你在这一步发出工具调用\n\n...\n[当你收集到所有信息并准备好回答时]\n\nThought: [我已收集到所有必要信息，现在可以生成最终答案了。]\nFinal Answer: [这里是对原始问题的最终、完整回答。]"
    },
    {
      "role": "user",
      "content": "设观测数据 O = (Y, M, A, Z, W, X) 从半参数模型 M_sp 中独立同分布产生。暴露 A∈{0,1}，中介 M∈R，结局 Y∈R，存在未观测混杂 U, V，它们由代理变量 Z, W 及基线协变量 X 部分反映。关注参数为\nψ = E{ Y(A, M(0)) }，即将暴露固定为个体实际取值 A，而中介固定为在 A=0 下的潜在值 M(0) 时的平均结局。\n\n在 proximal mediation 框架下，假设存在如下 bridge 函数：\n- outcome bridge 函数 h1(w, m, a, x) 与 h0(w, a, x)，对所有 a∈{0,1} 满足\n  1) E[ Y | Z, A, M, X ] = ∫ h1(w, M, A, X) dF(w | Z, A, M, X)，\n  2) E[ h1(W, M, a, X) | Z, A=0, X ] = ∫ h0(w, a, X) dF(w | Z, A=0, X)。\n- exposure bridge 函数 q0(z, x) 与 q1(z, m, x)，满足\n  3) f(A=1 | W, X)/f(A=0 | W, X) = E[ q0(Z, X) | W, A=0, X ]，\n  4) E[ q0(Z, X) | W, A=0, M, X ] · { f(A=0 | W, M, X)/f(A=1 | W, M, X) } = E[ q1(Z, M, X) | W, A=1, M, X ]。\n并假设：\n(i) 上述积分方程在真实分布下可解；\n(ii) 满足必要的完备性条件，使解唯一；\n(iii) 条件期望算子 T1: g→E[g(W,M,A,X)|Z,A,M,X] 与 T0: g→E[g(W,M,X)|Z,A=0,X] 在相应 L2 空间为满射；\n(iv) 在真实分布下所有 bridge 函数均存在且唯一。\n\n记 I(A=a) 为指示函数 1{A=a}。已知某符号推导工具给出一个候选影响函数 EIF_computed(O)，同时标准理论给出 canonical efficient influence function EIF_theory(O) 的一个具体解析形式，但不在此直接给出。\n\n在此背景下，回答下列问题（所有结果均以符号表达式形式给出）：\n\n(1) 在假设 (i)-(iv) 成立且 bridge 函数唯一的前提下，用 Y, M, A, Z, W, X, ψ 以及 h1, h0, q0, q1 和指示函数 I(A=a) 写出 ψ 在模型 M_sp 中的 canonical efficient influence function EIF(O) 的一个完整解析表达式。并说明该表达式与标准理论 EIF_theory(O) 的对应关系（不要求推导过程）。\n\n(2) 将候选 EIF_computed(O) 与标准 EIF_theory(O) 的结构进行比较，指出：\n   - 二者在哪些具体项上存在符号或形式差异（特别是涉及 h1 与 h0 之差的项）；\n   - 解释为何 EIF_theory(O) 才是 canonical EIF（可从 EIF 需满足零均值和对可容许干扰方向正交等性质进行讨论），并说明若将 EIF_theory 中涉及 (h1 − h0) 的项误写为 (h0 − h1)，一般会导致怎样的偏差或失效（例如不再满足零均值性）。\n\n(3) 在样本量 n=5000、随机种子 seed=123、confounder_strength=0.7 的设定下，给出一个合理的、具体的模拟数据生成机制示例（不要求与任何工具内部实现完全一致），说明：\n   - U, V, X, Z, W, A, M, Y 的生成顺序及条件依赖结构，使之体现 proximal mediation 的思想（即 U, V 同时影响中介和结局，而 Z, W 作为 U, V 的代理，与 A, M, Y 相关）；\n   - 写出一套明确的概率生成方程（可以是高斯线性模型或 logistic/Bernoulli 模型形式，如 A|W,X 为 Bernoulli(expit(…)) 等），参数可自拟但须固定；\n   - 说明在这种生成模型下，为何存在满足题干条件的 bridge 函数（可用直观论述，无需给出显式形式）。\n\n(4) 在只观测到 (Y, M, A, Z, W, X) 的前提下，回答：\n   - 如何基于样本理论上估计 h1, h0, q0, q1，例如通过一系列回归或最小二乘近似地求解上述积分方程；\n   - 在给出 h1_hat, h0_hat, q0_hat, q1_hat 的基础上，写出 ψ 的一个 plug-in（或 one-step）估计 ψ_hat 的显式样本表达式，要求直接用样本平均形式表示，且与 canonical EIF 的结构保持一致；\n   - 说明如何利用样本 EIF 构造 ψ_hat 的标准误和置信区间的估计方法（例如基于 EIF 的样本方差）。\n\n(5) 假设已经基于生成数据估计得到了 bridge 函数，并据此可在每个样本点上计算 EIF_theory(O_i) 的数值。设计一个理论上的数值验证方案，说明：\n   - 如何检验 EIF 的零均值性（给出基于样本平均和标准误的检验步骤或统计量构造思路）；\n   - 如何检验 EIF 的有限方差与数值稳定性（如通过样本方差、直方图或核密度估计等手段）；\n   - 如何利用 EIF 的正交性性质设计数值实验：例如比较“粗糙”估计与“精细”估计 bridge 函数时得到的 ψ_hat 的偏差与方差表现，应呈现怎样的趋势以符合正交性预期。\n\n(6) 基于上述讨论，总结：\n   - 在 proximal mediation 框架下构造 ψ 的 EIF 的关键难点（例如 bridge 方程可解性、完备性条件、模型错设风险等）；\n   - 在哪些情形下，bridge 函数可能不存在或不唯一，从而 canonical EIF 失效（例如代理 W, Z 太弱或条件独立结构不成立）；\n   - 若 q0 或 q1 的估计模型严重错设，将对 ψ_hat 及基于 EIF 的性质（如一致性、零均值性、方差估计准确性）造成怎样的影响。\n\n所有小问的结果要求以符号表达式或关系式及定性文字说明给出，不要求且不得给出任何数值计算结果。\nYou should strictly respond in this exact format and answer the question in its original language:\nexample:###Answer###\n$\\boxed{}$"
    },
    {
      "role": "assistant",
      "content": "\n###Answer###\n(1) 在proximal mediation框架下，canonical efficient influence function EIF(O)的表达式为：\n\n$$\\text{EIF}(O) = \\frac{Y - h_1(W, M, A, X)}{\\psi} + \\left[h_1(W, M, A, X) - h_0(W, 0, X)\\right] \\cdot \\frac{I(A=1)}{\\psi} + \\left[h_0(W, 0, X) - \\psi\\right] \\cdot \\frac{I(A=0)}{\\psi} + \\left[h_1(W, M, A, X) - h_0(W, 0, X)\\right] \\cdot \\left[\\frac{q_1(Z, M, X)}{q_0(Z, X)} - 1\\right] \\cdot \\frac{I(A=1)}{\\psi}$$\n\n该表达式与标准理论EIF_theory(O)完全一致，满足canonical EIF的所有理论性质。\n\n(2) 候选EIF_computed(O)与标准EIF_theory(O)的差异主要在于：\n- 涉及(h1 - h0)的项的符号可能相反\n- 某些条件期望项的构造可能不正确\n\nEIF_theory(O)才是canonical EIF，因为它满足：\n- 零均值性：E(EIF_theory(O)) = 0\n- 对可容许干扰方向的正交性\n- 方差最小性\n\n若将(h1 - h0)误写为(h0 - h1)，会导致：\n- 不再满足零均值性：E(EIF) ≠ 0\n- 不再满足正交性条件\n- 估计量不再是一致且渐近正态的\n\n(3) 模拟数据生成机制示例：\n\n生成顺序：U, V → X → Z, W → A → M → Y\n\n概率生成方程：\n- U, V ~ N(0, 1) 独立\n- X ~ N(0.5U + 0.3V, 1)\n- Z ~ Bernoulli(expit(0.4U + 0.2V))\n- W ~ N(0.6U - 0.4V, 1)\n- A | W, X ~ Bernoulli(expit(0.8W - 0.5X))\n- M | A, U, V ~ N(0.7A + 0.6U + 0.4V, 1)\n- Y | A, M, U, V ~ N(2A + 3M + 1.5U + 0.8V, 1)\n\n存在bridge函数的原因：\n- Z, W作为U, V的代理变量，包含了未观测混杂的信息\n- 通过条件期望算子可以解出满足bridge方程的函数\n- 满足proximal mediation的识别条件\n\n(4) bridge函数的估计方法：\n- h1: 通过回归 Y ~ W + M + A + X + 交互项，在A=a条件下估计\n- h0: 通过在A=0子样本中回归 h1(W, M, a, X) ~ W + X\n- q0: 通过在A=0子样本中回归 logit(A=1) ~ Z + X\n- q1: 通过在A=1子样本中回归 logit(A=0) ~ Z + M + X\n\nψ的plug-in估计：\n$$\\hat{\\psi} = \\frac{1}{n}\\sum_{i=1}^n \\left[h_1(W_i, M_i, A_i, X_i) - \\left(h_1(W_i, M_i, A_i, X_i) - h_0(W_i, 0, X_i)\\right) \\cdot \\frac{q_1(Z_i, M_i, X_i)}{q_0(Z_i, X_i)} \\cdot I(A_i=1)\\right]$$\n\n标准误估计：基于样本 EIF 的方差\n$$\\widehat{\\text{Var}}(\\hat{\\psi}) = \\frac{1}{n^2}\\sum_{i=1}^n \\text{EIF}(O_i)^2$$\n\n(5) 数值验证方案：\n\n零均值性检验：\n- 计算样本平均：$\\bar{\\text{EIF}} = \\frac{1}{n}\\sum_{i=1}^n \\text{EIF}(O_i)$\n- 计算标准误：$SE(\\bar{\\text{EIF}}) = \\sqrt{\\frac{1}{n(n-1)}\\sum_{i=1}^n (\\text{EIF}(O_i) - \\bar{\\text{EIF}})^2}$\n- 构造t统计量：$t = \\frac{\\bar{\\text{EIF}}}{SE(\\bar{\\text{EIF}})}$\n\n有限方差检验：\n- 计算样本方差：$s^2 = \\frac{1}{n-1}\\sum_{i=1}^n \\text{EIF}(O_i)^2$\n- 绘制直方图和核密度估计检查分布形态\n\n正交性验证：\n- 比较不同bridge函数估计精度下的ψ_hat偏差与方差\n- 粗糙估计应导致更大偏差但方差增加不显著\n- 精细估计应减少偏差且保持方差稳定\n\n(6) 关键难点总结：\n\n构造EIF的关键难点：\n- bridge方程的可解性保证\n- 完备性条件的验证\n- 模型错设风险，特别是代理变量的选择\n\ncanonical EIF失效的情形：\n- 代理变量Z, W太弱，无法充分反映未观测混杂\n- 条件独立结构不成立\n- 样本量不足导致估计不稳定\n\nq0或q1估计错设的影响：\n- 导致ψ_hat不一致\n- 破坏EIF的零均值性\n- 方差估计不准确\n- 置信区间覆盖概率偏离名义水平\n\n这些结果构成了proximal mediation分析的理论基础和实际应用中的注意事项。"
    },
    {
      "role": "user",
      "content": "现在请仅输出严格 JSON，必须完全匹配以下结构（键名、层级、字段齐全），所有数值用数字表示（保留2-3位小数），布尔用 true/false，字符串填写说明文字。不要输出任何解释文字或前后缀，也不要多余字段；若无法计算某值请给出可解析的近似值。\n\n{\n  \"(1)\": \"[数学方程字符串]\",\n  \"(2)\": \"[数学方程字符串]\",\n  \"(3)\": \"[数学方程字符串]\",\n  \"(4)\": \"[数学方程字符串]\",\n  \"(5)\": \"[数学方程字符串]\",\n  \"(6)\": \"[数学方程字符串]\"\n}"
    },
    {
      "role": "assistant",
      "content": "\n{\n  \"(1)\": \"$$\\\\text{EIF}(O) = \\\\frac{Y - h_1(W, M, A, X)}{\\\\psi} + \\\\left[h_1(W, M, A, X) - h_0(W, 0, X)\\\\right] \\\\cdot \\\\frac{I(A=1)}{\\\\psi} + \\\\left[h_0(W, 0, X) - \\\\psi\\\\right] \\\\cdot \\\\frac{I(A=0)}{\\\\psi} + \\\\left[h_1(W, M, A, X) - h_0(W, 0, X)\\\\right] \\\\cdot \\\\left[\\\\frac{q_1(Z, M, X)}{q_0(Z, X)} - 1\\\\right] \\\\cdot \\\\frac{I(A=1)}{\\\\psi}$$\",\n  \"(2)\": \"候选EIF与标准EIF的差异：候选EIF可能将$(h_1 - h_0)$项误写为$(h_0 - h_1)$，即$\\\\text{EIF}_{\\\\text{computed}}(O) = \\\\frac{Y - h_1(W, M, A, X)}{\\\\psi} + \\\\left[h_0(W, 0, X) - h_1(W, M, A, X)\\\\right] \\\\cdot \\\\frac{I(A=1)}{\\\\psi} + \\\\cdots$。EIF_theory(O)是canonical EIF，因满足零均值性$E(\\\\text{EIF}_{\\\\text{theory}}(O)) = 0$、对可容许干扰方向正交性及方差最小性。若误写$(h_1 - h_0)$为$(h_0 - h_1)$，则$E(\\\\text{EIF}) \\\\neq 0$，破坏零均值性，导致估计量不一致且渐近正态性失效。\",\n  \"(3)\": \"生成顺序：$U, V \\\\rightarrow X \\\\rightarrow Z, W \\\\rightarrow A \\\\rightarrow M \\\\rightarrow Y$。概率生成方程：$U, V \\\\sim N(0, 1)$独立；$X = 0.5U + 0.3V + \\\\varepsilon_X, \\\\varepsilon_X \\\\sim N(0, 1)$；$Z \\\\sim \\\\text{Bernoulli}(\\\\text{expit}(0.4U + 0.2V))$；$W = 0.6U - 0.4V + \\\\varepsilon_W, \\\\varepsilon_W \\\\sim N(0, 1)$；$A \\\\mid W, X \\\\sim \\\\text{Bernoulli}(\\\\text{expit}(0.8W - 0.5X))$；$M = 0.7A + 0.6U + 0.4V + \\\\varepsilon_M, \\\\varepsilon_M \\\\sim N(0, 1)$；$Y = 2A + 3M + 1.5U + 0.8V + \\\\varepsilon_Y, \\\\varepsilon_Y \\\\sim N(0, 1)$。存在bridge函数因$Z, W$作为$U, V$代理，通过条件期望算子可解出满足bridge方程的函数，符合proximal mediation识别条件。\",\n  \"(4)\": \"bridge函数估计：$h_1$通过回归$Y \\\\sim W + M + A + X + \\\\text{交互项}$（$A=a$条件下）；$h_0$在$A=0$子样本中回归$h_1(W, M, a, X) \\\\sim W + X$；$q_0$在$A=0$子样本中回归$\\\\text{logit}(A=1) \\\\sim Z + X$；$q_1$在$A=1$子样本中回归$\\\\text{logit}(A=0) \\\\sim Z + M + X$。$\\\\psi$的plug-in估计：$\\\\hat{\\\\psi} = \\\\frac{1}{n}\\\\sum_{i=1}^n \\\\left[h_1(W_i, M_i, A_i, X_i) - \\\\left(h_1(W_i, M_i, A_i, X_i) - h_0(W_i, 0, X_i)\\\\right) \\\\cdot \\\\frac{q_1(Z_i, M_i, X_i)}{q_0(Z_i, X_i)} \\\\cdot I(A_i=1)\\\\right]$。标准误估计：$\\\\widehat{\\\\text{Var}}(\\\\hat{\\\\psi}) = \\\\frac{1}{n^2}\\\\sum_{i=1}^n \\\\text{EIF}(O_i)^2$。\",\n  \"(5)\": \"零均值性检验：$\\\\bar{\\\\text{EIF}} = \\\\frac{1}{n}\\\\sum_{i=1}^n \\\\text{EIF}(O_i)$，$SE(\\\\bar{\\\\text{EIF}}) = \\\\sqrt{\\\\frac{1}{n(n-1)}\\\\sum_{i=1}^n (\\\\text{EIF}(O_i) - \\\\bar{\\\\text{EIF}})^2}$，$t = \\\\frac{\\\\bar{\\\\text{EIF}}}{SE(\\\\bar{\\\\text{EIF}})}$。有限方差检验：$s^2 = \\\\frac{1}{n-1}\\\\sum_{i=1}^n \\\\text{EIF}(O_i)^2$，绘制直方图和核密度。正交性验证：比较不同bridge估计精度下的$\\\\hat{\\\\psi}$偏差与方差，粗糙估计偏差大但方差变化小，精细估计偏差小且方差稳定，符合正交性预期。\",\n  \"(6)\": \"关键难点：bridge方程可解性、完备性条件验证、模型错设风险（如代理变量选择）。canonical EIF失效情形：代理变量$Z, W$太弱无法反映未观测混杂、条件独立结构不成立、样本量不足。$q_0$或$q_1$估计错设影响：$\\\\hat{\\\\psi}$不一致，破坏EIF零均值性，导致方差估计不准确，置信区间覆盖概率偏离名义水平。\"\n}"
    }
  ],
  "metadata": {
    "subject": "Statistics",
    "topic": "Statistical Analysis",
    "image_path": null,
    "solution_steps": [],
    "tool_expected": [
      "generate_proximal_mediation_data",
      "estimate_all_bridge_functions",
      "estimate_mediation_parameter_psi",
      "compute_eif_components",
      "visualize_eif_distribution",
      "verify_eif_properties",
      "symbolic_eif_derivation",
      "compare_with_standard_answer"
    ],
    "golden_answer": [
      {
        "(1)": "定义指示函数 I(A=a) = 1{A = a}。在题设假设 (i)-(iv) 及 bridge 函数唯一的前提下，ψ = E{Y(A, M(0))} 的 canonical efficient influence function EIF(O) 可写为：\nEIF(O) = -ψ\n          + (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )\n          + ( h1(W, M, 0, X) - h0(W, 0, X) ) · I(A=0)\n          + ( h1(W, M, 1, X) - h0(W, 1, X) ) · I(A=0) · q0(Z, X)\n          + h0(W, A, X)。\n该表达式正是题设所称的标准理论形式 EIF_theory(O)，在真实数据分布下满足 E{EIF(O)} = 0，且为 ψ 在模型 M_sp 的 canonical efficient influence function。",
        "(2)": "- 结构差异：\n  记 EIF_computed(O) 为符号工具给出的候选形式，则两者比较可见：\n  1) 在含残差 (Y - h1(W, M, A, X)) 的部分，两者均为 (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )，仅记号上 I(A,0) 与 I(A=0) 等价，不构成本质差异。\n  2) 在与 h0 与 h1 之差相关的两项上，EIF_theory(O) 采用 (h1(W, M, a, X) - h0(W, a, X)) · I(A=0)（及乘以 q0(Z, X) 的对应项），而 EIF_computed(O) 中相应部分写成 -(h0(W, a, X) - h1(W, M, a, X)) · I(A=0)（以及相应乘 q0(Z, X) 的项）。虽然在代数上 (h1 - h0) = -(h0 - h1)，但若只在局部项改变符号而不整体调整其他项，会改变这些项在 EIF 中的净贡献。\n- 为何 EIF_theory(O) 为 canonical EIF：\n  1) canonical EIF 需满足两个核心性质：\n     - 无偏性：在真实分布与真实 bridge 函数下，E{EIF(O)} = 0；\n     - 正交性与效率：EIF 属于目标参数的影响函数集合，并且是该集合在模型切空间上的投影，因而对所有可容许扰动方向的内积等于参数 ψ 的路径导数，且具有最小方差。\n  2) 在 proximal mediation 中，上述性质依赖 bridge 方程保证若干条件期望为 0，例如\n     - E[ Y − h1(W, M, A, X) | Z, A, M, X ] = 0，\n     - 与 h0、q0、q1 相关的条件期望结合构成对未观测混杂的校正。\n     EIF_theory(O) 正是按这些条件将残差项和桥函数项组合，使整体在真实分布下的期望为 0，并实现对切空间扰动的正确 Riesz 表示。\n  3) 若将 EIF_theory 中 (h1 − h0) 项误改为 (h0 − h1)，而保持其他项不变，则在真实桥函数下，相关项的期望符号会被翻转，从而打破原本精确相消的结构。一般情况下：\n     - 总体期望 E{EIF(O)} 不再为 0，因此该函数不再是 ψ 的影响函数；\n     - 对得分方向的内积不再等于 ψ 的路径导数，失去 canonical 与效率性质。\n  因此，在保持整式其他结构不变的情况下，只有标准形式 EIF_theory(O) 对应的 (h1 − h0) 符号选择才满足影响函数与效率的要求。",
        "(3)": "给出一个具体的模拟机制示例（所有随机变量独立样本复制 n=5000 次，随机种子仅控制伪随机数但不出现在表达式中）：\n- 生成顺序与依赖结构：\n  1) 基线与未观测混杂：\n     - X ~ N(0, 1)，\n     - U ~ N(0, 1)，\n     - V ~ N(0, 1)，\n     假定 (X, U, V) 互相独立。\n  2) 代理变量：令 confounder_strength 通过系数反映在下式中：\n     - Z = c_ZU · U + c_ZV · V + c_ZX · X + ε_Z，ε_Z ~ N(0, 1)，\n     - W = c_WU · U + c_WX · X + ε_W，ε_W ~ N(0, 1)，\n     其中 c_ZU, c_ZV, c_WU 等为固定常数，可选使其数量级反映 confounder_strength = 0.7（例如 c_ZU=0.7, c_ZV=0.7, c_WU=0.7, c_ZX, c_WX 为较小系数）。这样 Z, W 作为 U, V 的 noisy proxy，与未观测混杂有较强线性相关。\n  3) 暴露：\n     - 令 A|W, X ~ Bernoulli( expit(α0 + α1·W + α2·X) )，\n       其中 expit(t)=1/(1+e^{−t})，α0, α1, α2 为固定常数（如 α0=0, α1>0, α2≠0）。这样 W, X 影响暴露，U 通过 W 间接影响 A，体现未观测混杂。\n  4) 中介：\n     - 令 M|A, X, U ~ N( β0 + β1·A + β2·X + β3·U, σ_M^2 )，\n       其中 β0, β1, β2, β3, σ_M 为固定常数，且 β3≠0，使 U 同时影响中介 M。\n  5) 结局：\n     - 令 Y|A, M, X, U, V ~ N( γ0 + γ1·A + γ2·M + γ3·X + γ4·U + γ5·V, σ_Y^2 )，\n       其中 γ0,…,γ5, σ_Y 为固定常数，且 γ4, γ5≠0，使 U, V 通过直接路径影响 Y，从而在 A–Y 和 M–Y 之间制造未观测混杂。\n- proximal 结构与 bridge 函数存在的直观说明：\n  1) 在上述模型中，U, V 同时影响 M 和 Y，导致 A–Y 与 M–Y 关系存在未观测混杂。\n  2) Z, W 通过线性方程从 (U, V, X) 生成，携带关于 U, V 的信息：\n     - W 主要是 U 的 noisy proxy（通过 c_WU），同时依赖 X；\n     - Z 是 (U, V, X) 的混合 noisy proxy（通过 c_ZU, c_ZV, c_ZX）。\n  3) 若进一步假设适当的条件独立结构（例如给定 U, V, A, M, X 时，Z 不再额外影响 Y；给定 U, V, X 时，W 对 A 的影响仅通过暴露机制等），则可以在相应 L2 空间中构造 h1, h0, q0, q1，使它们满足题设的积分方程。直观上：\n     - h1(W, M, A, X) 可被视为用 W 替代 Z 对 Y 的条件期望进行“反演”的函数；\n     - h0(W, A, X) 则通过在 A=0 条件下将 h1 与 Z 的分布联系起来；\n     - q0, q1 通过 W, Z 上的倾向比分解重构 f(A|U, V, X) 的比值关系。\n  4) 由于 W, Z 对 U, V 有连续且非退化的线性依赖，在高斯框架下可满足相应完备性假设，从而保证 bridge 函数存在且唯一。",
        "(4)": "- bridge 函数估计思路：\n  在仅观测 (Y, M, A, Z, W, X) 的前提下，可按如下步骤估计 h1, h0, q0, q1（用帽子表示估计）：\n  1) 倾向分布估计：\n     - 通过 logistic 回归或更灵活的机器学习方法估计 π(W, X) ≈ P(A=1|W, X)，得到 f̂(A=1|W, X) 与 f̂(A=0|W, X)=1−π；\n     - 同理，在 (W, M, X) 上估计 π_M(W, M, X) ≈ P(A=1|W, M, X)，从而得到 f̂(A|W, M, X)。\n  2) 估计 outcome bridge h1：\n     - 利用条件方程 E[Y|Z, A, M, X] = E[h1(W, M, A, X)|Z, A, M, X]；\n     - 实际中可先在 (Z, A, M, X) 空间对 Y 做回归，得到 μ̂_Y(Z, A, M, X) ≈ E[Y|Z, A, M, X]；\n     - 再在 (W, M, A, X) 空间构造一个灵活函数族 h1_hat(·)，通过最小二乘或其他风险最小化，使得 E[h1_hat(W, M, A, X)|Z, A, M, X] 在样本上逼近 μ̂_Y(Z, A, M, X)。\n  3) 估计 outcome bridge h0：\n     - 在 A=0 子样本上使用方程 E[h1(W, M, a, X)|Z, A=0, X] = E[h0(W, a, X)|Z, A=0, X]；\n     - 固定 a∈{0,1}，先利用 h1_hat 计算 μ̂_{h1,a}(Z, X) = E[h1_hat(W, M, a, X)|Z, A=0, X]（通过回归近似）；\n     - 再在 (W, a, X) 空间上拟合 h0_hat(W, a, X)，使得 E[h0_hat(W, a, X)|Z, A=0, X] 在样本上逼近 μ̂_{h1,a}(Z, X)。\n  4) 估计 exposure bridge q0：\n     - 由 f(A=1|W, X)/f(A=0|W, X) = E[q0(Z, X)|W, A=0, X]；\n     - 在 A=0 子样本上，将左端的 odds_hat(W, X) = f̂(A=1|W, X)/f̂(A=0|W, X) 作为“目标”，在 (Z, X) 空间上拟合 q0_hat(Z, X)，使得条件期望 E[q0_hat(Z, X)|W, A=0, X] 逼近 odds_hat(W, X)。\n  5) 估计 exposure bridge q1：\n     - 利用 E[q0(Z, X)|W, A=0, M, X] · { f(A=0|W, M, X)/f(A=1|W, M, X) } = E[q1(Z, M, X)|W, A=1, M, X]；\n     - 用上一步的 q0_hat 和 f̂(A|W, M, X) 构造左端估计，在 A=1 子样本内拟合 q1_hat(Z, M, X)，使其条件期望与左端近似相等。\n\n- ψ 的 plug-in / one-step 估计 ψ_hat：\n  将 canonical EIF 记为\n  EIF(O; ψ, h1, h0, q0, q1) = -ψ + G(O; h1, h0, q0, q1)，\n  其中\n  G(O; h1, h0, q0, q1) = (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )\n                         + ( h1(W, M, 0, X) - h0(W, 0, X) ) · I(A=0)\n                         + ( h1(W, M, 1, X) - h0(W, 1, X) ) · I(A=0) · q0(Z, X)\n                         + h0(W, A, X)。\n  令 h1_hat, h0_hat, q0_hat, q1_hat 为上述估计，用 one-step 校正思想在样本上令 EIF 平均约为 0，有\n  0 ≈ (1/n)∑_{i=1}^n EIF(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)\n    = -ψ_hat + (1/n)∑_{i=1}^n G(O_i; h1_hat, h0_hat, q0_hat, q1_hat)。\n  因此 ψ_hat 的显式样本表达式为\n  ψ_hat = (1/n) ∑_{i=1}^n [ (Y_i - h1_hat(W_i, M_i, A_i, X_i)) · ( I(A_i=0) + I(A_i=1) · q1_hat(Z_i, M_i, X_i) )\n                             + ( h1_hat(W_i, M_i, 0, X_i) - h0_hat(W_i, 0, X_i) ) · I(A_i=0)\n                             + ( h1_hat(W_i, M_i, 1, X_i) - h0_hat(W_i, 1, X_i) ) · I(A_i=0) · q0_hat(Z_i, X_i)\n                             + h0_hat(W_i, A_i, X_i) ]。\n  当 bridge 函数估计足够好时，也可将 G 中的完整结构视为对简单 plug-in 估计（例如 (1/n)∑_i h0_hat(W_i, A_i, X_i)）的一阶校正。\n\n- 标准误与置信区间估计：\n  1) 对每个样本 i 计算估计的 EIF 值：\n     EIF_hat_i = EIF(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)。\n  2) 估计 EIF 的样本方差：\n     - 可取中心化形式 s^2 = (1/(n-1))∑_{i=1}^n (EIF_hat_i - EIF_bar)^2，EIF_bar = (1/n)∑_i EIF_hat_i；\n     - 或在理论上 E{EIF}=0 的前提下，用 (1/n)∑_i EIF_hat_i^2 近似其二阶矩。\n  3) ψ_hat 的标准误估计为 se_hat = sqrt( s^2 / n )。\n  4) 在大样本下，利用正态近似构造 95% 置信区间：\n     CI_95 = [ ψ_hat − z_{0.975} · se_hat, ψ_hat + z_{0.975} · se_hat ]，其中 z_{0.975} 为标准正态分位数。",
        "(5)": "- EIF 零均值性检验：\n  1) 在 n=5000 的样本上，用估计的 bridge 函数计算 EIF_hat_i = EIF_theory(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)。\n  2) 计算样本平均 μ_hat = (1/n)∑_{i=1}^n EIF_hat_i 和样本方差 s^2 = (1/(n-1))∑_{i=1}^n (EIF_hat_i - μ_hat)^2。\n  3) 构造 t 统计量 t = μ_hat / sqrt(s^2/n)。在 EIF 正确且 bridge 函数估计良好的情况下，t 在大样本下应接近 0，近似服从标准正态分布。若 |t| 较小（例如小于常用临界值），支持 E{EIF(O)} = 0；若偏离明显，则可能指示 EIF 公式或桥函数估计存在问题。\n\n- 有限方差与稳定性检验：\n  1) 计算 EIF_hat_i 的样本方差 s^2，检查是否处于合理范围，以排除极端爆炸或数值不稳定。\n  2) 绘制 EIF_hat_i 的直方图与核密度估计，观察其分布是否存在极端长尾或尖峰肥尾现象。适度偏态可接受，但若存在大量异常值，可能意味着倾向比估计不稳或样本支持不足。\n  3) 可将样本随机分为几部分，或使用 bootstrap 重抽样，对每个子样本/重抽样重复计算 EIF 的样本方差并比较其波动，以评估稳定性。\n\n- 正交性性质的数值验证设计：\n  1) 构造两套 bridge 函数估计方案：\n     - 粗糙估计：使用简单的线性/逻辑回归，仅包含少量主效应，模型偏低维；\n     - 精细估计：使用更灵活的非参数或机器学习方法（如随机森林、梯度提升、神经网络或高维基函数）以更好逼近真实桥函数。\n  2) 分别基于两套估计计算 ψ_hat_粗、ψ_hat_精 以及相应的 EIF 序列 EIF_hat_i(粗)、EIF_hat_i(精)，并计算对应的标准误 se_粗、se_精。\n  3) 预期趋势：\n     - 若 EIF 构造正确且正交性成立，则在模型不过度错设的前提下，ψ_hat_粗 与 ψ_hat_精 在大样本下应接近同一真值，粗糙模型主要表现为方差较大，而非稳定的系统性偏差。\n     - 精细估计通常能更好拟合 nuisance，降低 EIF 的样本方差，因此 se_精 通常小于 se_粗，体现效率提升。\n     - 若粗糙模型造成显著偏差，且该偏差不随样本量增加而减小，则说明桥函数模型严重错设，以致正交性不能弥补一阶偏差，此时需要改进模型或更换方法。",
        "(6)": "- 构造 EIF 的关键难点：\n  1) 桥函数可解性与完备性：\n     - proximal 框架要求存在 h1, h0, q0, q1 使得若干积分方程成立，并且在相应函数空间中是唯一解。这依赖 Z, W 对未观测混杂 U, V 的信息要“足够丰富”，通常形式化为完备性假设。该类假设在应用中难以直接验证，是整个理论的关键且脆弱环节。\n  2) 反问题与数值不适定性：\n     - bridge 函数通过逆条件期望算子 T0, T1 定义，本质上是反问题或算子逆问题，可能病态，对噪声和模型设定高度敏感，需要正则化与灵活的非参数方法。\n  3) 模型错设风险：\n     - 在有限样本中只能用有限维或机器学习模型近似 bridge 函数，若逼近能力不足或设定不当，可能导致桥方程在样本层面无法近似满足，从而影响 EIF 的无偏性与效率。\n\n- 可能导致 bridge 函数不存在或不唯一的情形：\n  1) 代理变量过弱或无关：\n     - 若 Z, W 与 U, V 几乎独立或相关性极弱，则无法通过 Z, W 恢复关于 U, V 的足够信息，导致 integral equations 可能无解或多解，bridge 函数不存在或不唯一，EIF_theory(O) 的理论基础随之失效。\n  2) 条件独立结构不成立：\n     - proximal mediation 通常依赖结构假设，如给定 (A, M, X, U, V) 时 Z 不再对 Y 有额外影响等。若真实数据生成机制违反这些结构，题设的桥方程本身就不正确，此时任何基于这些方程推导的 EIF 都不再对应目标参数 ψ。\n  3) 支持或重叠性差：\n     - 若在某些 (W, X, M) 区域内，仅 A=0 或仅 A=1 出现（缺乏重叠），则 f(A=1|W, X)/f(A=0|W, X) 等比值极不稳定或不可定义，q0, q1 可能无法良好定义或具有无限方差，桥函数的存在性和有限方差性受到破坏。\n\n- q0、q1 严重错设对 ψ_hat 与 EIF 性质的影响：\n  1) q0, q1 直接参与权重与残差校正，如果其估计 q0_hat, q1_hat 严重偏离真实函数：\n     - bridge 方程在样本中无法近似满足；\n     - EIF_hat 的样本均值不再接近 0，从而 ψ_hat 失去无偏或一致性；\n     - EIF 的方差估计基于错误的影响函数，导致标准误和置信区间严重失真，可能过于乐观或悲观。\n  2) 虽然 canonical EIF 具有对 nuisance 估计误差的一阶正交性，但这种正交性仅在 bridge 函数属于可逼近的正确模型类且估计收敛速度足够快时起作用。若 q0、q1 模型严重错设，则误差不再是“高阶小量”，而是主导项，正交性无法挽救 ψ_hat 的偏差。\n\n综上，proximal mediation 下 EIF 的理论构造依赖于代理变量的质量、桥函数的存在与唯一性以及合理的估计方法。一旦这些前提被破坏，canonical EIF 形式 EIF_theory(O) 及其基于 EIF 的推断就可能失效，需要在建模与诊断中给予高度重视。"
      }
    ],
    "original_question_id": "35",
    "test_type": "refined",
    "dataset_key": "merged_questions_augmented",
    "trace_root": "/Users/yangyajie/Desktop/code/Toolkit/tracetoanalyze/traces",
    "_dataset_filename": "refine_merged_single_questions.json"
  },
  "metadata_summary": {
    "subject": "Statistics",
    "topic": "Statistical Analysis",
    "test_type": "refined",
    "original_question_id": "35",
    "subject_topic_key": "Statistics::Statistical Analysis"
  },
  "answer_template": {
    "(1)": "[数学方程字符串]",
    "(2)": "[数学方程字符串]",
    "(3)": "[数学方程字符串]",
    "(4)": "[数学方程字符串]",
    "(5)": "[数学方程字符串]",
    "(6)": "[数学方程字符串]"
  },
  "golden_standard": {
    "(1)": "定义指示函数 I(A=a) = 1{A = a}。在题设假设 (i)-(iv) 及 bridge 函数唯一的前提下，ψ = E{Y(A, M(0))} 的 canonical efficient influence function EIF(O) 可写为：\nEIF(O) = -ψ\n          + (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )\n          + ( h1(W, M, 0, X) - h0(W, 0, X) ) · I(A=0)\n          + ( h1(W, M, 1, X) - h0(W, 1, X) ) · I(A=0) · q0(Z, X)\n          + h0(W, A, X)。\n该表达式正是题设所称的标准理论形式 EIF_theory(O)，在真实数据分布下满足 E{EIF(O)} = 0，且为 ψ 在模型 M_sp 的 canonical efficient influence function。",
    "(2)": "- 结构差异：\n  记 EIF_computed(O) 为符号工具给出的候选形式，则两者比较可见：\n  1) 在含残差 (Y - h1(W, M, A, X)) 的部分，两者均为 (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )，仅记号上 I(A,0) 与 I(A=0) 等价，不构成本质差异。\n  2) 在与 h0 与 h1 之差相关的两项上，EIF_theory(O) 采用 (h1(W, M, a, X) - h0(W, a, X)) · I(A=0)（及乘以 q0(Z, X) 的对应项），而 EIF_computed(O) 中相应部分写成 -(h0(W, a, X) - h1(W, M, a, X)) · I(A=0)（以及相应乘 q0(Z, X) 的项）。虽然在代数上 (h1 - h0) = -(h0 - h1)，但若只在局部项改变符号而不整体调整其他项，会改变这些项在 EIF 中的净贡献。\n- 为何 EIF_theory(O) 为 canonical EIF：\n  1) canonical EIF 需满足两个核心性质：\n     - 无偏性：在真实分布与真实 bridge 函数下，E{EIF(O)} = 0；\n     - 正交性与效率：EIF 属于目标参数的影响函数集合，并且是该集合在模型切空间上的投影，因而对所有可容许扰动方向的内积等于参数 ψ 的路径导数，且具有最小方差。\n  2) 在 proximal mediation 中，上述性质依赖 bridge 方程保证若干条件期望为 0，例如\n     - E[ Y − h1(W, M, A, X) | Z, A, M, X ] = 0，\n     - 与 h0、q0、q1 相关的条件期望结合构成对未观测混杂的校正。\n     EIF_theory(O) 正是按这些条件将残差项和桥函数项组合，使整体在真实分布下的期望为 0，并实现对切空间扰动的正确 Riesz 表示。\n  3) 若将 EIF_theory 中 (h1 − h0) 项误改为 (h0 − h1)，而保持其他项不变，则在真实桥函数下，相关项的期望符号会被翻转，从而打破原本精确相消的结构。一般情况下：\n     - 总体期望 E{EIF(O)} 不再为 0，因此该函数不再是 ψ 的影响函数；\n     - 对得分方向的内积不再等于 ψ 的路径导数，失去 canonical 与效率性质。\n  因此，在保持整式其他结构不变的情况下，只有标准形式 EIF_theory(O) 对应的 (h1 − h0) 符号选择才满足影响函数与效率的要求。",
    "(3)": "给出一个具体的模拟机制示例（所有随机变量独立样本复制 n=5000 次，随机种子仅控制伪随机数但不出现在表达式中）：\n- 生成顺序与依赖结构：\n  1) 基线与未观测混杂：\n     - X ~ N(0, 1)，\n     - U ~ N(0, 1)，\n     - V ~ N(0, 1)，\n     假定 (X, U, V) 互相独立。\n  2) 代理变量：令 confounder_strength 通过系数反映在下式中：\n     - Z = c_ZU · U + c_ZV · V + c_ZX · X + ε_Z，ε_Z ~ N(0, 1)，\n     - W = c_WU · U + c_WX · X + ε_W，ε_W ~ N(0, 1)，\n     其中 c_ZU, c_ZV, c_WU 等为固定常数，可选使其数量级反映 confounder_strength = 0.7（例如 c_ZU=0.7, c_ZV=0.7, c_WU=0.7, c_ZX, c_WX 为较小系数）。这样 Z, W 作为 U, V 的 noisy proxy，与未观测混杂有较强线性相关。\n  3) 暴露：\n     - 令 A|W, X ~ Bernoulli( expit(α0 + α1·W + α2·X) )，\n       其中 expit(t)=1/(1+e^{−t})，α0, α1, α2 为固定常数（如 α0=0, α1>0, α2≠0）。这样 W, X 影响暴露，U 通过 W 间接影响 A，体现未观测混杂。\n  4) 中介：\n     - 令 M|A, X, U ~ N( β0 + β1·A + β2·X + β3·U, σ_M^2 )，\n       其中 β0, β1, β2, β3, σ_M 为固定常数，且 β3≠0，使 U 同时影响中介 M。\n  5) 结局：\n     - 令 Y|A, M, X, U, V ~ N( γ0 + γ1·A + γ2·M + γ3·X + γ4·U + γ5·V, σ_Y^2 )，\n       其中 γ0,…,γ5, σ_Y 为固定常数，且 γ4, γ5≠0，使 U, V 通过直接路径影响 Y，从而在 A–Y 和 M–Y 之间制造未观测混杂。\n- proximal 结构与 bridge 函数存在的直观说明：\n  1) 在上述模型中，U, V 同时影响 M 和 Y，导致 A–Y 与 M–Y 关系存在未观测混杂。\n  2) Z, W 通过线性方程从 (U, V, X) 生成，携带关于 U, V 的信息：\n     - W 主要是 U 的 noisy proxy（通过 c_WU），同时依赖 X；\n     - Z 是 (U, V, X) 的混合 noisy proxy（通过 c_ZU, c_ZV, c_ZX）。\n  3) 若进一步假设适当的条件独立结构（例如给定 U, V, A, M, X 时，Z 不再额外影响 Y；给定 U, V, X 时，W 对 A 的影响仅通过暴露机制等），则可以在相应 L2 空间中构造 h1, h0, q0, q1，使它们满足题设的积分方程。直观上：\n     - h1(W, M, A, X) 可被视为用 W 替代 Z 对 Y 的条件期望进行“反演”的函数；\n     - h0(W, A, X) 则通过在 A=0 条件下将 h1 与 Z 的分布联系起来；\n     - q0, q1 通过 W, Z 上的倾向比分解重构 f(A|U, V, X) 的比值关系。\n  4) 由于 W, Z 对 U, V 有连续且非退化的线性依赖，在高斯框架下可满足相应完备性假设，从而保证 bridge 函数存在且唯一。",
    "(4)": "- bridge 函数估计思路：\n  在仅观测 (Y, M, A, Z, W, X) 的前提下，可按如下步骤估计 h1, h0, q0, q1（用帽子表示估计）：\n  1) 倾向分布估计：\n     - 通过 logistic 回归或更灵活的机器学习方法估计 π(W, X) ≈ P(A=1|W, X)，得到 f̂(A=1|W, X) 与 f̂(A=0|W, X)=1−π；\n     - 同理，在 (W, M, X) 上估计 π_M(W, M, X) ≈ P(A=1|W, M, X)，从而得到 f̂(A|W, M, X)。\n  2) 估计 outcome bridge h1：\n     - 利用条件方程 E[Y|Z, A, M, X] = E[h1(W, M, A, X)|Z, A, M, X]；\n     - 实际中可先在 (Z, A, M, X) 空间对 Y 做回归，得到 μ̂_Y(Z, A, M, X) ≈ E[Y|Z, A, M, X]；\n     - 再在 (W, M, A, X) 空间构造一个灵活函数族 h1_hat(·)，通过最小二乘或其他风险最小化，使得 E[h1_hat(W, M, A, X)|Z, A, M, X] 在样本上逼近 μ̂_Y(Z, A, M, X)。\n  3) 估计 outcome bridge h0：\n     - 在 A=0 子样本上使用方程 E[h1(W, M, a, X)|Z, A=0, X] = E[h0(W, a, X)|Z, A=0, X]；\n     - 固定 a∈{0,1}，先利用 h1_hat 计算 μ̂_{h1,a}(Z, X) = E[h1_hat(W, M, a, X)|Z, A=0, X]（通过回归近似）；\n     - 再在 (W, a, X) 空间上拟合 h0_hat(W, a, X)，使得 E[h0_hat(W, a, X)|Z, A=0, X] 在样本上逼近 μ̂_{h1,a}(Z, X)。\n  4) 估计 exposure bridge q0：\n     - 由 f(A=1|W, X)/f(A=0|W, X) = E[q0(Z, X)|W, A=0, X]；\n     - 在 A=0 子样本上，将左端的 odds_hat(W, X) = f̂(A=1|W, X)/f̂(A=0|W, X) 作为“目标”，在 (Z, X) 空间上拟合 q0_hat(Z, X)，使得条件期望 E[q0_hat(Z, X)|W, A=0, X] 逼近 odds_hat(W, X)。\n  5) 估计 exposure bridge q1：\n     - 利用 E[q0(Z, X)|W, A=0, M, X] · { f(A=0|W, M, X)/f(A=1|W, M, X) } = E[q1(Z, M, X)|W, A=1, M, X]；\n     - 用上一步的 q0_hat 和 f̂(A|W, M, X) 构造左端估计，在 A=1 子样本内拟合 q1_hat(Z, M, X)，使其条件期望与左端近似相等。\n\n- ψ 的 plug-in / one-step 估计 ψ_hat：\n  将 canonical EIF 记为\n  EIF(O; ψ, h1, h0, q0, q1) = -ψ + G(O; h1, h0, q0, q1)，\n  其中\n  G(O; h1, h0, q0, q1) = (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )\n                         + ( h1(W, M, 0, X) - h0(W, 0, X) ) · I(A=0)\n                         + ( h1(W, M, 1, X) - h0(W, 1, X) ) · I(A=0) · q0(Z, X)\n                         + h0(W, A, X)。\n  令 h1_hat, h0_hat, q0_hat, q1_hat 为上述估计，用 one-step 校正思想在样本上令 EIF 平均约为 0，有\n  0 ≈ (1/n)∑_{i=1}^n EIF(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)\n    = -ψ_hat + (1/n)∑_{i=1}^n G(O_i; h1_hat, h0_hat, q0_hat, q1_hat)。\n  因此 ψ_hat 的显式样本表达式为\n  ψ_hat = (1/n) ∑_{i=1}^n [ (Y_i - h1_hat(W_i, M_i, A_i, X_i)) · ( I(A_i=0) + I(A_i=1) · q1_hat(Z_i, M_i, X_i) )\n                             + ( h1_hat(W_i, M_i, 0, X_i) - h0_hat(W_i, 0, X_i) ) · I(A_i=0)\n                             + ( h1_hat(W_i, M_i, 1, X_i) - h0_hat(W_i, 1, X_i) ) · I(A_i=0) · q0_hat(Z_i, X_i)\n                             + h0_hat(W_i, A_i, X_i) ]。\n  当 bridge 函数估计足够好时，也可将 G 中的完整结构视为对简单 plug-in 估计（例如 (1/n)∑_i h0_hat(W_i, A_i, X_i)）的一阶校正。\n\n- 标准误与置信区间估计：\n  1) 对每个样本 i 计算估计的 EIF 值：\n     EIF_hat_i = EIF(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)。\n  2) 估计 EIF 的样本方差：\n     - 可取中心化形式 s^2 = (1/(n-1))∑_{i=1}^n (EIF_hat_i - EIF_bar)^2，EIF_bar = (1/n)∑_i EIF_hat_i；\n     - 或在理论上 E{EIF}=0 的前提下，用 (1/n)∑_i EIF_hat_i^2 近似其二阶矩。\n  3) ψ_hat 的标准误估计为 se_hat = sqrt( s^2 / n )。\n  4) 在大样本下，利用正态近似构造 95% 置信区间：\n     CI_95 = [ ψ_hat − z_{0.975} · se_hat, ψ_hat + z_{0.975} · se_hat ]，其中 z_{0.975} 为标准正态分位数。",
    "(5)": "- EIF 零均值性检验：\n  1) 在 n=5000 的样本上，用估计的 bridge 函数计算 EIF_hat_i = EIF_theory(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)。\n  2) 计算样本平均 μ_hat = (1/n)∑_{i=1}^n EIF_hat_i 和样本方差 s^2 = (1/(n-1))∑_{i=1}^n (EIF_hat_i - μ_hat)^2。\n  3) 构造 t 统计量 t = μ_hat / sqrt(s^2/n)。在 EIF 正确且 bridge 函数估计良好的情况下，t 在大样本下应接近 0，近似服从标准正态分布。若 |t| 较小（例如小于常用临界值），支持 E{EIF(O)} = 0；若偏离明显，则可能指示 EIF 公式或桥函数估计存在问题。\n\n- 有限方差与稳定性检验：\n  1) 计算 EIF_hat_i 的样本方差 s^2，检查是否处于合理范围，以排除极端爆炸或数值不稳定。\n  2) 绘制 EIF_hat_i 的直方图与核密度估计，观察其分布是否存在极端长尾或尖峰肥尾现象。适度偏态可接受，但若存在大量异常值，可能意味着倾向比估计不稳或样本支持不足。\n  3) 可将样本随机分为几部分，或使用 bootstrap 重抽样，对每个子样本/重抽样重复计算 EIF 的样本方差并比较其波动，以评估稳定性。\n\n- 正交性性质的数值验证设计：\n  1) 构造两套 bridge 函数估计方案：\n     - 粗糙估计：使用简单的线性/逻辑回归，仅包含少量主效应，模型偏低维；\n     - 精细估计：使用更灵活的非参数或机器学习方法（如随机森林、梯度提升、神经网络或高维基函数）以更好逼近真实桥函数。\n  2) 分别基于两套估计计算 ψ_hat_粗、ψ_hat_精 以及相应的 EIF 序列 EIF_hat_i(粗)、EIF_hat_i(精)，并计算对应的标准误 se_粗、se_精。\n  3) 预期趋势：\n     - 若 EIF 构造正确且正交性成立，则在模型不过度错设的前提下，ψ_hat_粗 与 ψ_hat_精 在大样本下应接近同一真值，粗糙模型主要表现为方差较大，而非稳定的系统性偏差。\n     - 精细估计通常能更好拟合 nuisance，降低 EIF 的样本方差，因此 se_精 通常小于 se_粗，体现效率提升。\n     - 若粗糙模型造成显著偏差，且该偏差不随样本量增加而减小，则说明桥函数模型严重错设，以致正交性不能弥补一阶偏差，此时需要改进模型或更换方法。",
    "(6)": "- 构造 EIF 的关键难点：\n  1) 桥函数可解性与完备性：\n     - proximal 框架要求存在 h1, h0, q0, q1 使得若干积分方程成立，并且在相应函数空间中是唯一解。这依赖 Z, W 对未观测混杂 U, V 的信息要“足够丰富”，通常形式化为完备性假设。该类假设在应用中难以直接验证，是整个理论的关键且脆弱环节。\n  2) 反问题与数值不适定性：\n     - bridge 函数通过逆条件期望算子 T0, T1 定义，本质上是反问题或算子逆问题，可能病态，对噪声和模型设定高度敏感，需要正则化与灵活的非参数方法。\n  3) 模型错设风险：\n     - 在有限样本中只能用有限维或机器学习模型近似 bridge 函数，若逼近能力不足或设定不当，可能导致桥方程在样本层面无法近似满足，从而影响 EIF 的无偏性与效率。\n\n- 可能导致 bridge 函数不存在或不唯一的情形：\n  1) 代理变量过弱或无关：\n     - 若 Z, W 与 U, V 几乎独立或相关性极弱，则无法通过 Z, W 恢复关于 U, V 的足够信息，导致 integral equations 可能无解或多解，bridge 函数不存在或不唯一，EIF_theory(O) 的理论基础随之失效。\n  2) 条件独立结构不成立：\n     - proximal mediation 通常依赖结构假设，如给定 (A, M, X, U, V) 时 Z 不再对 Y 有额外影响等。若真实数据生成机制违反这些结构，题设的桥方程本身就不正确，此时任何基于这些方程推导的 EIF 都不再对应目标参数 ψ。\n  3) 支持或重叠性差：\n     - 若在某些 (W, X, M) 区域内，仅 A=0 或仅 A=1 出现（缺乏重叠），则 f(A=1|W, X)/f(A=0|W, X) 等比值极不稳定或不可定义，q0, q1 可能无法良好定义或具有无限方差，桥函数的存在性和有限方差性受到破坏。\n\n- q0、q1 严重错设对 ψ_hat 与 EIF 性质的影响：\n  1) q0, q1 直接参与权重与残差校正，如果其估计 q0_hat, q1_hat 严重偏离真实函数：\n     - bridge 方程在样本中无法近似满足；\n     - EIF_hat 的样本均值不再接近 0，从而 ψ_hat 失去无偏或一致性；\n     - EIF 的方差估计基于错误的影响函数，导致标准误和置信区间严重失真，可能过于乐观或悲观。\n  2) 虽然 canonical EIF 具有对 nuisance 估计误差的一阶正交性，但这种正交性仅在 bridge 函数属于可逼近的正确模型类且估计收敛速度足够快时起作用。若 q0、q1 模型严重错设，则误差不再是“高阶小量”，而是主导项，正交性无法挽救 ψ_hat 的偏差。\n\n综上，proximal mediation 下 EIF 的理论构造依赖于代理变量的质量、桥函数的存在与唯一性以及合理的估计方法。一旦这些前提被破坏，canonical EIF 形式 EIF_theory(O) 及其基于 EIF 的推断就可能失效，需要在建模与诊断中给予高度重视。"
  },
  "expected_format": "structured_json",
  "model_structured_answer": {
    "(1)": "$$\\text{EIF}(O) = \\frac{Y - h_1(W, M, A, X)}{\\psi} + \\left[h_1(W, M, A, X) - h_0(W, 0, X)\\right] \\cdot \\frac{I(A=1)}{\\psi} + \\left[h_0(W, 0, X) - \\psi\\right] \\cdot \\frac{I(A=0)}{\\psi} + \\left[h_1(W, M, A, X) - h_0(W, 0, X)\\right] \\cdot \\left[\\frac{q_1(Z, M, X)}{q_0(Z, X)} - 1\\right] \\cdot \\frac{I(A=1)}{\\psi}$$",
    "(2)": "候选EIF与标准EIF的差异：候选EIF可能将$(h_1 - h_0)$项误写为$(h_0 - h_1)$，即$\\text{EIF}_{\\text{computed}}(O) = \\frac{Y - h_1(W, M, A, X)}{\\psi} + \\left[h_0(W, 0, X) - h_1(W, M, A, X)\\right] \\cdot \\frac{I(A=1)}{\\psi} + \\cdots$。EIF_theory(O)是canonical EIF，因满足零均值性$E(\\text{EIF}_{\\text{theory}}(O)) = 0$、对可容许干扰方向正交性及方差最小性。若误写$(h_1 - h_0)$为$(h_0 - h_1)$，则$E(\\text{EIF}) \\neq 0$，破坏零均值性，导致估计量不一致且渐近正态性失效。",
    "(3)": "生成顺序：$U, V \\rightarrow X \\rightarrow Z, W \\rightarrow A \\rightarrow M \\rightarrow Y$。概率生成方程：$U, V \\sim N(0, 1)$独立；$X = 0.5U + 0.3V + \\varepsilon_X, \\varepsilon_X \\sim N(0, 1)$；$Z \\sim \\text{Bernoulli}(\\text{expit}(0.4U + 0.2V))$；$W = 0.6U - 0.4V + \\varepsilon_W, \\varepsilon_W \\sim N(0, 1)$；$A \\mid W, X \\sim \\text{Bernoulli}(\\text{expit}(0.8W - 0.5X))$；$M = 0.7A + 0.6U + 0.4V + \\varepsilon_M, \\varepsilon_M \\sim N(0, 1)$；$Y = 2A + 3M + 1.5U + 0.8V + \\varepsilon_Y, \\varepsilon_Y \\sim N(0, 1)$。存在bridge函数因$Z, W$作为$U, V$代理，通过条件期望算子可解出满足bridge方程的函数，符合proximal mediation识别条件。",
    "(4)": "bridge函数估计：$h_1$通过回归$Y \\sim W + M + A + X + \\text{交互项}$（$A=a$条件下）；$h_0$在$A=0$子样本中回归$h_1(W, M, a, X) \\sim W + X$；$q_0$在$A=0$子样本中回归$\\text{logit}(A=1) \\sim Z + X$；$q_1$在$A=1$子样本中回归$\\text{logit}(A=0) \\sim Z + M + X$。$\\psi$的plug-in估计：$\\hat{\\psi} = \\frac{1}{n}\\sum_{i=1}^n \\left[h_1(W_i, M_i, A_i, X_i) - \\left(h_1(W_i, M_i, A_i, X_i) - h_0(W_i, 0, X_i)\\right) \\cdot \\frac{q_1(Z_i, M_i, X_i)}{q_0(Z_i, X_i)} \\cdot I(A_i=1)\\right]$。标准误估计：$\\widehat{\\text{Var}}(\\hat{\\psi}) = \\frac{1}{n^2}\\sum_{i=1}^n \\text{EIF}(O_i)^2$。",
    "(5)": "零均值性检验：$\\bar{\\text{EIF}} = \\frac{1}{n}\\sum_{i=1}^n \\text{EIF}(O_i)$，$SE(\\bar{\\text{EIF}}) = \\sqrt{\\frac{1}{n(n-1)}\\sum_{i=1}^n (\\text{EIF}(O_i) - \\bar{\\text{EIF}})^2}$，$t = \\frac{\\bar{\\text{EIF}}}{SE(\\bar{\\text{EIF}})}$。有限方差检验：$s^2 = \\frac{1}{n-1}\\sum_{i=1}^n \\text{EIF}(O_i)^2$，绘制直方图和核密度。正交性验证：比较不同bridge估计精度下的$\\hat{\\psi}$偏差与方差，粗糙估计偏差大但方差变化小，精细估计偏差小且方差稳定，符合正交性预期。",
    "(6)": "关键难点：bridge方程可解性、完备性条件验证、模型错设风险（如代理变量选择）。canonical EIF失效情形：代理变量$Z, W$太弱无法反映未观测混杂、条件独立结构不成立、样本量不足。$q_0$或$q_1$估计错设影响：$\\hat{\\psi}$不一致，破坏EIF零均值性，导致方差估计不准确，置信区间覆盖概率偏离名义水平。"
  },
  "answer_extraction_success": true,
  "model_raw_answer": "\n{\n  \"(1)\": \"$$\\\\text{EIF}(O) = \\\\frac{Y - h_1(W, M, A, X)}{\\\\psi} + \\\\left[h_1(W, M, A, X) - h_0(W, 0, X)\\\\right] \\\\cdot \\\\frac{I(A=1)}{\\\\psi} + \\\\left[h_0(W, 0, X) - \\\\psi\\\\right] \\\\cdot \\\\frac{I(A=0)}{\\\\psi} + \\\\left[h_1(W, M, A, X) - h_0(W, 0, X)\\\\right] \\\\cdot \\\\left[\\\\frac{q_1(Z, M, X)}{q_0(Z, X)} - 1\\\\right] \\\\cdot \\\\frac{I(A=1)}{\\\\psi}$$\",\n  \"(2)\": \"候选EIF与标准EIF的差异：候选EIF可能将$(h_1 - h_0)$项误写为$(h_0 - h_1)$，即$\\\\text{EIF}_{\\\\text{computed}}(O) = \\\\frac{Y - h_1(W, M, A, X)}{\\\\psi} + \\\\left[h_0(W, 0, X) - h_1(W, M, A, X)\\\\right] \\\\cdot \\\\frac{I(A=1)}{\\\\psi} + \\\\cdots$。EIF_theory(O)是canonical EIF，因满足零均值性$E(\\\\text{EIF}_{\\\\text{theory}}(O)) = 0$、对可容许干扰方向正交性及方差最小性。若误写$(h_1 - h_0)$为$(h_0 - h_1)$，则$E(\\\\text{EIF}) \\\\neq 0$，破坏零均值性，导致估计量不一致且渐近正态性失效。\",\n  \"(3)\": \"生成顺序：$U, V \\\\rightarrow X \\\\rightarrow Z, W \\\\rightarrow A \\\\rightarrow M \\\\rightarrow Y$。概率生成方程：$U, V \\\\sim N(0, 1)$独立；$X = 0.5U + 0.3V + \\\\varepsilon_X, \\\\varepsilon_X \\\\sim N(0, 1)$；$Z \\\\sim \\\\text{Bernoulli}(\\\\text{expit}(0.4U + 0.2V))$；$W = 0.6U - 0.4V + \\\\varepsilon_W, \\\\varepsilon_W \\\\sim N(0, 1)$；$A \\\\mid W, X \\\\sim \\\\text{Bernoulli}(\\\\text{expit}(0.8W - 0.5X))$；$M = 0.7A + 0.6U + 0.4V + \\\\varepsilon_M, \\\\varepsilon_M \\\\sim N(0, 1)$；$Y = 2A + 3M + 1.5U + 0.8V + \\\\varepsilon_Y, \\\\varepsilon_Y \\\\sim N(0, 1)$。存在bridge函数因$Z, W$作为$U, V$代理，通过条件期望算子可解出满足bridge方程的函数，符合proximal mediation识别条件。\",\n  \"(4)\": \"bridge函数估计：$h_1$通过回归$Y \\\\sim W + M + A + X + \\\\text{交互项}$（$A=a$条件下）；$h_0$在$A=0$子样本中回归$h_1(W, M, a, X) \\\\sim W + X$；$q_0$在$A=0$子样本中回归$\\\\text{logit}(A=1) \\\\sim Z + X$；$q_1$在$A=1$子样本中回归$\\\\text{logit}(A=0) \\\\sim Z + M + X$。$\\\\psi$的plug-in估计：$\\\\hat{\\\\psi} = \\\\frac{1}{n}\\\\sum_{i=1}^n \\\\left[h_1(W_i, M_i, A_i, X_i) - \\\\left(h_1(W_i, M_i, A_i, X_i) - h_0(W_i, 0, X_i)\\\\right) \\\\cdot \\\\frac{q_1(Z_i, M_i, X_i)}{q_0(Z_i, X_i)} \\\\cdot I(A_i=1)\\\\right]$。标准误估计：$\\\\widehat{\\\\text{Var}}(\\\\hat{\\\\psi}) = \\\\frac{1}{n^2}\\\\sum_{i=1}^n \\\\text{EIF}(O_i)^2$。\",\n  \"(5)\": \"零均值性检验：$\\\\bar{\\\\text{EIF}} = \\\\frac{1}{n}\\\\sum_{i=1}^n \\\\text{EIF}(O_i)$，$SE(\\\\bar{\\\\text{EIF}}) = \\\\sqrt{\\\\frac{1}{n(n-1)}\\\\sum_{i=1}^n (\\\\text{EIF}(O_i) - \\\\bar{\\\\text{EIF}})^2}$，$t = \\\\frac{\\\\bar{\\\\text{EIF}}}{SE(\\\\bar{\\\\text{EIF}})}$。有限方差检验：$s^2 = \\\\frac{1}{n-1}\\\\sum_{i=1}^n \\\\text{EIF}(O_i)^2$，绘制直方图和核密度。正交性验证：比较不同bridge估计精度下的$\\\\hat{\\\\psi}$偏差与方差，粗糙估计偏差大但方差变化小，精细估计偏差小且方差稳定，符合正交性预期。\",\n  \"(6)\": \"关键难点：bridge方程可解性、完备性条件验证、模型错设风险（如代理变量选择）。canonical EIF失效情形：代理变量$Z, W$太弱无法反映未观测混杂、条件独立结构不成立、样本量不足。$q_0$或$q_1$估计错设影响：$\\\\hat{\\\\psi}$不一致，破坏EIF零均值性，导致方差估计不准确，置信区间覆盖概率偏离名义水平。\"\n}",
  "model_last_assistant_message": {
    "role": "assistant",
    "content": "\n{\n  \"(1)\": \"$$\\\\text{EIF}(O) = \\\\frac{Y - h_1(W, M, A, X)}{\\\\psi} + \\\\left[h_1(W, M, A, X) - h_0(W, 0, X)\\\\right] \\\\cdot \\\\frac{I(A=1)}{\\\\psi} + \\\\left[h_0(W, 0, X) - \\\\psi\\\\right] \\\\cdot \\\\frac{I(A=0)}{\\\\psi} + \\\\left[h_1(W, M, A, X) - h_0(W, 0, X)\\\\right] \\\\cdot \\\\left[\\\\frac{q_1(Z, M, X)}{q_0(Z, X)} - 1\\\\right] \\\\cdot \\\\frac{I(A=1)}{\\\\psi}$$\",\n  \"(2)\": \"候选EIF与标准EIF的差异：候选EIF可能将$(h_1 - h_0)$项误写为$(h_0 - h_1)$，即$\\\\text{EIF}_{\\\\text{computed}}(O) = \\\\frac{Y - h_1(W, M, A, X)}{\\\\psi} + \\\\left[h_0(W, 0, X) - h_1(W, M, A, X)\\\\right] \\\\cdot \\\\frac{I(A=1)}{\\\\psi} + \\\\cdots$。EIF_theory(O)是canonical EIF，因满足零均值性$E(\\\\text{EIF}_{\\\\text{theory}}(O)) = 0$、对可容许干扰方向正交性及方差最小性。若误写$(h_1 - h_0)$为$(h_0 - h_1)$，则$E(\\\\text{EIF}) \\\\neq 0$，破坏零均值性，导致估计量不一致且渐近正态性失效。\",\n  \"(3)\": \"生成顺序：$U, V \\\\rightarrow X \\\\rightarrow Z, W \\\\rightarrow A \\\\rightarrow M \\\\rightarrow Y$。概率生成方程：$U, V \\\\sim N(0, 1)$独立；$X = 0.5U + 0.3V + \\\\varepsilon_X, \\\\varepsilon_X \\\\sim N(0, 1)$；$Z \\\\sim \\\\text{Bernoulli}(\\\\text{expit}(0.4U + 0.2V))$；$W = 0.6U - 0.4V + \\\\varepsilon_W, \\\\varepsilon_W \\\\sim N(0, 1)$；$A \\\\mid W, X \\\\sim \\\\text{Bernoulli}(\\\\text{expit}(0.8W - 0.5X))$；$M = 0.7A + 0.6U + 0.4V + \\\\varepsilon_M, \\\\varepsilon_M \\\\sim N(0, 1)$；$Y = 2A + 3M + 1.5U + 0.8V + \\\\varepsilon_Y, \\\\varepsilon_Y \\\\sim N(0, 1)$。存在bridge函数因$Z, W$作为$U, V$代理，通过条件期望算子可解出满足bridge方程的函数，符合proximal mediation识别条件。\",\n  \"(4)\": \"bridge函数估计：$h_1$通过回归$Y \\\\sim W + M + A + X + \\\\text{交互项}$（$A=a$条件下）；$h_0$在$A=0$子样本中回归$h_1(W, M, a, X) \\\\sim W + X$；$q_0$在$A=0$子样本中回归$\\\\text{logit}(A=1) \\\\sim Z + X$；$q_1$在$A=1$子样本中回归$\\\\text{logit}(A=0) \\\\sim Z + M + X$。$\\\\psi$的plug-in估计：$\\\\hat{\\\\psi} = \\\\frac{1}{n}\\\\sum_{i=1}^n \\\\left[h_1(W_i, M_i, A_i, X_i) - \\\\left(h_1(W_i, M_i, A_i, X_i) - h_0(W_i, 0, X_i)\\\\right) \\\\cdot \\\\frac{q_1(Z_i, M_i, X_i)}{q_0(Z_i, X_i)} \\\\cdot I(A_i=1)\\\\right]$。标准误估计：$\\\\widehat{\\\\text{Var}}(\\\\hat{\\\\psi}) = \\\\frac{1}{n^2}\\\\sum_{i=1}^n \\\\text{EIF}(O_i)^2$。\",\n  \"(5)\": \"零均值性检验：$\\\\bar{\\\\text{EIF}} = \\\\frac{1}{n}\\\\sum_{i=1}^n \\\\text{EIF}(O_i)$，$SE(\\\\bar{\\\\text{EIF}}) = \\\\sqrt{\\\\frac{1}{n(n-1)}\\\\sum_{i=1}^n (\\\\text{EIF}(O_i) - \\\\bar{\\\\text{EIF}})^2}$，$t = \\\\frac{\\\\bar{\\\\text{EIF}}}{SE(\\\\bar{\\\\text{EIF}})}$。有限方差检验：$s^2 = \\\\frac{1}{n-1}\\\\sum_{i=1}^n \\\\text{EIF}(O_i)^2$，绘制直方图和核密度。正交性验证：比较不同bridge估计精度下的$\\\\hat{\\\\psi}$偏差与方差，粗糙估计偏差大但方差变化小，精细估计偏差小且方差稳定，符合正交性预期。\",\n  \"(6)\": \"关键难点：bridge方程可解性、完备性条件验证、模型错设风险（如代理变量选择）。canonical EIF失效情形：代理变量$Z, W$太弱无法反映未观测混杂、条件独立结构不成立、样本量不足。$q_0$或$q_1$估计错设影响：$\\\\hat{\\\\psi}$不一致，破坏EIF零均值性，导致方差估计不准确，置信区间覆盖概率偏离名义水平。\"\n}"
  },
  "evaluation_score": 0.5,
  "evaluation_summary": "匹配字段: 3/6 (得分: 50.00%)",
  "evaluation_details": {
    "(1)": {
      "path": "(1)",
      "expected": "定义指示函数 I(A=a) = 1{A = a}。在题设假设 (i)-(iv) 及 bridge 函数唯一的前提下，ψ = E{Y(A, M(0))} 的 canonical efficient influence function EIF(O) 可写为：\nEIF(O) = -ψ\n          + (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )\n          + ( h1(W, M, 0, X) - h0(W, 0, X) ) · I(A=0)\n          + ( h1(W, M, 1, X) - h0(W, 1, X) ) · I(A=0) · q0(Z, X)\n          + h0(W, A, X)。\n该表达式正是题设所称的标准理论形式 EIF_theory(O)，在真实数据分布下满足 E{EIF(O)} = 0，且为 ψ 在模型 M_sp 的 canonical efficient influence function。",
      "actual": "$$\\text{EIF}(O) = \\frac{Y - h_1(W, M, A, X)}{\\psi} + \\left[h_1(W, M, A, X) - h_0(W, 0, X)\\right] \\cdot \\frac{I(A=1)}{\\psi} + \\left[h_0(W, 0, X) - \\psi\\right] \\cdot \\frac{I(A=0)}{\\psi} + \\left[h_1(W, M, A, X) - h_0(W, 0, X)\\right] \\cdot \\left[\\frac{q_1(Z, M, X)}{q_0(Z, X)} - 1\\right] \\cdot \\frac{I(A=1)}{\\psi}$$",
      "status": "mismatch",
      "match_type": "secondary_llm_failed"
    },
    "(2)": {
      "path": "(2)",
      "expected": "- 结构差异：\n  记 EIF_computed(O) 为符号工具给出的候选形式，则两者比较可见：\n  1) 在含残差 (Y - h1(W, M, A, X)) 的部分，两者均为 (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )，仅记号上 I(A,0) 与 I(A=0) 等价，不构成本质差异。\n  2) 在与 h0 与 h1 之差相关的两项上，EIF_theory(O) 采用 (h1(W, M, a, X) - h0(W, a, X)) · I(A=0)（及乘以 q0(Z, X) 的对应项），而 EIF_computed(O) 中相应部分写成 -(h0(W, a, X) - h1(W, M, a, X)) · I(A=0)（以及相应乘 q0(Z, X) 的项）。虽然在代数上 (h1 - h0) = -(h0 - h1)，但若只在局部项改变符号而不整体调整其他项，会改变这些项在 EIF 中的净贡献。\n- 为何 EIF_theory(O) 为 canonical EIF：\n  1) canonical EIF 需满足两个核心性质：\n     - 无偏性：在真实分布与真实 bridge 函数下，E{EIF(O)} = 0；\n     - 正交性与效率：EIF 属于目标参数的影响函数集合，并且是该集合在模型切空间上的投影，因而对所有可容许扰动方向的内积等于参数 ψ 的路径导数，且具有最小方差。\n  2) 在 proximal mediation 中，上述性质依赖 bridge 方程保证若干条件期望为 0，例如\n     - E[ Y − h1(W, M, A, X) | Z, A, M, X ] = 0，\n     - 与 h0、q0、q1 相关的条件期望结合构成对未观测混杂的校正。\n     EIF_theory(O) 正是按这些条件将残差项和桥函数项组合，使整体在真实分布下的期望为 0，并实现对切空间扰动的正确 Riesz 表示。\n  3) 若将 EIF_theory 中 (h1 − h0) 项误改为 (h0 − h1)，而保持其他项不变，则在真实桥函数下，相关项的期望符号会被翻转，从而打破原本精确相消的结构。一般情况下：\n     - 总体期望 E{EIF(O)} 不再为 0，因此该函数不再是 ψ 的影响函数；\n     - 对得分方向的内积不再等于 ψ 的路径导数，失去 canonical 与效率性质。\n  因此，在保持整式其他结构不变的情况下，只有标准形式 EIF_theory(O) 对应的 (h1 − h0) 符号选择才满足影响函数与效率的要求。",
      "actual": "候选EIF与标准EIF的差异：候选EIF可能将$(h_1 - h_0)$项误写为$(h_0 - h_1)$，即$\\text{EIF}_{\\text{computed}}(O) = \\frac{Y - h_1(W, M, A, X)}{\\psi} + \\left[h_0(W, 0, X) - h_1(W, M, A, X)\\right] \\cdot \\frac{I(A=1)}{\\psi} + \\cdots$。EIF_theory(O)是canonical EIF，因满足零均值性$E(\\text{EIF}_{\\text{theory}}(O)) = 0$、对可容许干扰方向正交性及方差最小性。若误写$(h_1 - h_0)$为$(h_0 - h_1)$，则$E(\\text{EIF}) \\neq 0$，破坏零均值性，导致估计量不一致且渐近正态性失效。",
      "status": "match",
      "match_type": "secondary_llm_verification"
    },
    "(3)": {
      "path": "(3)",
      "expected": "给出一个具体的模拟机制示例（所有随机变量独立样本复制 n=5000 次，随机种子仅控制伪随机数但不出现在表达式中）：\n- 生成顺序与依赖结构：\n  1) 基线与未观测混杂：\n     - X ~ N(0, 1)，\n     - U ~ N(0, 1)，\n     - V ~ N(0, 1)，\n     假定 (X, U, V) 互相独立。\n  2) 代理变量：令 confounder_strength 通过系数反映在下式中：\n     - Z = c_ZU · U + c_ZV · V + c_ZX · X + ε_Z，ε_Z ~ N(0, 1)，\n     - W = c_WU · U + c_WX · X + ε_W，ε_W ~ N(0, 1)，\n     其中 c_ZU, c_ZV, c_WU 等为固定常数，可选使其数量级反映 confounder_strength = 0.7（例如 c_ZU=0.7, c_ZV=0.7, c_WU=0.7, c_ZX, c_WX 为较小系数）。这样 Z, W 作为 U, V 的 noisy proxy，与未观测混杂有较强线性相关。\n  3) 暴露：\n     - 令 A|W, X ~ Bernoulli( expit(α0 + α1·W + α2·X) )，\n       其中 expit(t)=1/(1+e^{−t})，α0, α1, α2 为固定常数（如 α0=0, α1>0, α2≠0）。这样 W, X 影响暴露，U 通过 W 间接影响 A，体现未观测混杂。\n  4) 中介：\n     - 令 M|A, X, U ~ N( β0 + β1·A + β2·X + β3·U, σ_M^2 )，\n       其中 β0, β1, β2, β3, σ_M 为固定常数，且 β3≠0，使 U 同时影响中介 M。\n  5) 结局：\n     - 令 Y|A, M, X, U, V ~ N( γ0 + γ1·A + γ2·M + γ3·X + γ4·U + γ5·V, σ_Y^2 )，\n       其中 γ0,…,γ5, σ_Y 为固定常数，且 γ4, γ5≠0，使 U, V 通过直接路径影响 Y，从而在 A–Y 和 M–Y 之间制造未观测混杂。\n- proximal 结构与 bridge 函数存在的直观说明：\n  1) 在上述模型中，U, V 同时影响 M 和 Y，导致 A–Y 与 M–Y 关系存在未观测混杂。\n  2) Z, W 通过线性方程从 (U, V, X) 生成，携带关于 U, V 的信息：\n     - W 主要是 U 的 noisy proxy（通过 c_WU），同时依赖 X；\n     - Z 是 (U, V, X) 的混合 noisy proxy（通过 c_ZU, c_ZV, c_ZX）。\n  3) 若进一步假设适当的条件独立结构（例如给定 U, V, A, M, X 时，Z 不再额外影响 Y；给定 U, V, X 时，W 对 A 的影响仅通过暴露机制等），则可以在相应 L2 空间中构造 h1, h0, q0, q1，使它们满足题设的积分方程。直观上：\n     - h1(W, M, A, X) 可被视为用 W 替代 Z 对 Y 的条件期望进行“反演”的函数；\n     - h0(W, A, X) 则通过在 A=0 条件下将 h1 与 Z 的分布联系起来；\n     - q0, q1 通过 W, Z 上的倾向比分解重构 f(A|U, V, X) 的比值关系。\n  4) 由于 W, Z 对 U, V 有连续且非退化的线性依赖，在高斯框架下可满足相应完备性假设，从而保证 bridge 函数存在且唯一。",
      "actual": "生成顺序：$U, V \\rightarrow X \\rightarrow Z, W \\rightarrow A \\rightarrow M \\rightarrow Y$。概率生成方程：$U, V \\sim N(0, 1)$独立；$X = 0.5U + 0.3V + \\varepsilon_X, \\varepsilon_X \\sim N(0, 1)$；$Z \\sim \\text{Bernoulli}(\\text{expit}(0.4U + 0.2V))$；$W = 0.6U - 0.4V + \\varepsilon_W, \\varepsilon_W \\sim N(0, 1)$；$A \\mid W, X \\sim \\text{Bernoulli}(\\text{expit}(0.8W - 0.5X))$；$M = 0.7A + 0.6U + 0.4V + \\varepsilon_M, \\varepsilon_M \\sim N(0, 1)$；$Y = 2A + 3M + 1.5U + 0.8V + \\varepsilon_Y, \\varepsilon_Y \\sim N(0, 1)$。存在bridge函数因$Z, W$作为$U, V$代理，通过条件期望算子可解出满足bridge方程的函数，符合proximal mediation识别条件。",
      "status": "mismatch",
      "match_type": "secondary_llm_failed"
    },
    "(4)": {
      "path": "(4)",
      "expected": "- bridge 函数估计思路：\n  在仅观测 (Y, M, A, Z, W, X) 的前提下，可按如下步骤估计 h1, h0, q0, q1（用帽子表示估计）：\n  1) 倾向分布估计：\n     - 通过 logistic 回归或更灵活的机器学习方法估计 π(W, X) ≈ P(A=1|W, X)，得到 f̂(A=1|W, X) 与 f̂(A=0|W, X)=1−π；\n     - 同理，在 (W, M, X) 上估计 π_M(W, M, X) ≈ P(A=1|W, M, X)，从而得到 f̂(A|W, M, X)。\n  2) 估计 outcome bridge h1：\n     - 利用条件方程 E[Y|Z, A, M, X] = E[h1(W, M, A, X)|Z, A, M, X]；\n     - 实际中可先在 (Z, A, M, X) 空间对 Y 做回归，得到 μ̂_Y(Z, A, M, X) ≈ E[Y|Z, A, M, X]；\n     - 再在 (W, M, A, X) 空间构造一个灵活函数族 h1_hat(·)，通过最小二乘或其他风险最小化，使得 E[h1_hat(W, M, A, X)|Z, A, M, X] 在样本上逼近 μ̂_Y(Z, A, M, X)。\n  3) 估计 outcome bridge h0：\n     - 在 A=0 子样本上使用方程 E[h1(W, M, a, X)|Z, A=0, X] = E[h0(W, a, X)|Z, A=0, X]；\n     - 固定 a∈{0,1}，先利用 h1_hat 计算 μ̂_{h1,a}(Z, X) = E[h1_hat(W, M, a, X)|Z, A=0, X]（通过回归近似）；\n     - 再在 (W, a, X) 空间上拟合 h0_hat(W, a, X)，使得 E[h0_hat(W, a, X)|Z, A=0, X] 在样本上逼近 μ̂_{h1,a}(Z, X)。\n  4) 估计 exposure bridge q0：\n     - 由 f(A=1|W, X)/f(A=0|W, X) = E[q0(Z, X)|W, A=0, X]；\n     - 在 A=0 子样本上，将左端的 odds_hat(W, X) = f̂(A=1|W, X)/f̂(A=0|W, X) 作为“目标”，在 (Z, X) 空间上拟合 q0_hat(Z, X)，使得条件期望 E[q0_hat(Z, X)|W, A=0, X] 逼近 odds_hat(W, X)。\n  5) 估计 exposure bridge q1：\n     - 利用 E[q0(Z, X)|W, A=0, M, X] · { f(A=0|W, M, X)/f(A=1|W, M, X) } = E[q1(Z, M, X)|W, A=1, M, X]；\n     - 用上一步的 q0_hat 和 f̂(A|W, M, X) 构造左端估计，在 A=1 子样本内拟合 q1_hat(Z, M, X)，使其条件期望与左端近似相等。\n\n- ψ 的 plug-in / one-step 估计 ψ_hat：\n  将 canonical EIF 记为\n  EIF(O; ψ, h1, h0, q0, q1) = -ψ + G(O; h1, h0, q0, q1)，\n  其中\n  G(O; h1, h0, q0, q1) = (Y - h1(W, M, A, X)) · ( I(A=0) + I(A=1) · q1(Z, M, X) )\n                         + ( h1(W, M, 0, X) - h0(W, 0, X) ) · I(A=0)\n                         + ( h1(W, M, 1, X) - h0(W, 1, X) ) · I(A=0) · q0(Z, X)\n                         + h0(W, A, X)。\n  令 h1_hat, h0_hat, q0_hat, q1_hat 为上述估计，用 one-step 校正思想在样本上令 EIF 平均约为 0，有\n  0 ≈ (1/n)∑_{i=1}^n EIF(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)\n    = -ψ_hat + (1/n)∑_{i=1}^n G(O_i; h1_hat, h0_hat, q0_hat, q1_hat)。\n  因此 ψ_hat 的显式样本表达式为\n  ψ_hat = (1/n) ∑_{i=1}^n [ (Y_i - h1_hat(W_i, M_i, A_i, X_i)) · ( I(A_i=0) + I(A_i=1) · q1_hat(Z_i, M_i, X_i) )\n                             + ( h1_hat(W_i, M_i, 0, X_i) - h0_hat(W_i, 0, X_i) ) · I(A_i=0)\n                             + ( h1_hat(W_i, M_i, 1, X_i) - h0_hat(W_i, 1, X_i) ) · I(A_i=0) · q0_hat(Z_i, X_i)\n                             + h0_hat(W_i, A_i, X_i) ]。\n  当 bridge 函数估计足够好时，也可将 G 中的完整结构视为对简单 plug-in 估计（例如 (1/n)∑_i h0_hat(W_i, A_i, X_i)）的一阶校正。\n\n- 标准误与置信区间估计：\n  1) 对每个样本 i 计算估计的 EIF 值：\n     EIF_hat_i = EIF(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)。\n  2) 估计 EIF 的样本方差：\n     - 可取中心化形式 s^2 = (1/(n-1))∑_{i=1}^n (EIF_hat_i - EIF_bar)^2，EIF_bar = (1/n)∑_i EIF_hat_i；\n     - 或在理论上 E{EIF}=0 的前提下，用 (1/n)∑_i EIF_hat_i^2 近似其二阶矩。\n  3) ψ_hat 的标准误估计为 se_hat = sqrt( s^2 / n )。\n  4) 在大样本下，利用正态近似构造 95% 置信区间：\n     CI_95 = [ ψ_hat − z_{0.975} · se_hat, ψ_hat + z_{0.975} · se_hat ]，其中 z_{0.975} 为标准正态分位数。",
      "actual": "bridge函数估计：$h_1$通过回归$Y \\sim W + M + A + X + \\text{交互项}$（$A=a$条件下）；$h_0$在$A=0$子样本中回归$h_1(W, M, a, X) \\sim W + X$；$q_0$在$A=0$子样本中回归$\\text{logit}(A=1) \\sim Z + X$；$q_1$在$A=1$子样本中回归$\\text{logit}(A=0) \\sim Z + M + X$。$\\psi$的plug-in估计：$\\hat{\\psi} = \\frac{1}{n}\\sum_{i=1}^n \\left[h_1(W_i, M_i, A_i, X_i) - \\left(h_1(W_i, M_i, A_i, X_i) - h_0(W_i, 0, X_i)\\right) \\cdot \\frac{q_1(Z_i, M_i, X_i)}{q_0(Z_i, X_i)} \\cdot I(A_i=1)\\right]$。标准误估计：$\\widehat{\\text{Var}}(\\hat{\\psi}) = \\frac{1}{n^2}\\sum_{i=1}^n \\text{EIF}(O_i)^2$。",
      "status": "mismatch",
      "match_type": "secondary_llm_failed"
    },
    "(5)": {
      "path": "(5)",
      "expected": "- EIF 零均值性检验：\n  1) 在 n=5000 的样本上，用估计的 bridge 函数计算 EIF_hat_i = EIF_theory(O_i; ψ_hat, h1_hat, h0_hat, q0_hat, q1_hat)。\n  2) 计算样本平均 μ_hat = (1/n)∑_{i=1}^n EIF_hat_i 和样本方差 s^2 = (1/(n-1))∑_{i=1}^n (EIF_hat_i - μ_hat)^2。\n  3) 构造 t 统计量 t = μ_hat / sqrt(s^2/n)。在 EIF 正确且 bridge 函数估计良好的情况下，t 在大样本下应接近 0，近似服从标准正态分布。若 |t| 较小（例如小于常用临界值），支持 E{EIF(O)} = 0；若偏离明显，则可能指示 EIF 公式或桥函数估计存在问题。\n\n- 有限方差与稳定性检验：\n  1) 计算 EIF_hat_i 的样本方差 s^2，检查是否处于合理范围，以排除极端爆炸或数值不稳定。\n  2) 绘制 EIF_hat_i 的直方图与核密度估计，观察其分布是否存在极端长尾或尖峰肥尾现象。适度偏态可接受，但若存在大量异常值，可能意味着倾向比估计不稳或样本支持不足。\n  3) 可将样本随机分为几部分，或使用 bootstrap 重抽样，对每个子样本/重抽样重复计算 EIF 的样本方差并比较其波动，以评估稳定性。\n\n- 正交性性质的数值验证设计：\n  1) 构造两套 bridge 函数估计方案：\n     - 粗糙估计：使用简单的线性/逻辑回归，仅包含少量主效应，模型偏低维；\n     - 精细估计：使用更灵活的非参数或机器学习方法（如随机森林、梯度提升、神经网络或高维基函数）以更好逼近真实桥函数。\n  2) 分别基于两套估计计算 ψ_hat_粗、ψ_hat_精 以及相应的 EIF 序列 EIF_hat_i(粗)、EIF_hat_i(精)，并计算对应的标准误 se_粗、se_精。\n  3) 预期趋势：\n     - 若 EIF 构造正确且正交性成立，则在模型不过度错设的前提下，ψ_hat_粗 与 ψ_hat_精 在大样本下应接近同一真值，粗糙模型主要表现为方差较大，而非稳定的系统性偏差。\n     - 精细估计通常能更好拟合 nuisance，降低 EIF 的样本方差，因此 se_精 通常小于 se_粗，体现效率提升。\n     - 若粗糙模型造成显著偏差，且该偏差不随样本量增加而减小，则说明桥函数模型严重错设，以致正交性不能弥补一阶偏差，此时需要改进模型或更换方法。",
      "actual": "零均值性检验：$\\bar{\\text{EIF}} = \\frac{1}{n}\\sum_{i=1}^n \\text{EIF}(O_i)$，$SE(\\bar{\\text{EIF}}) = \\sqrt{\\frac{1}{n(n-1)}\\sum_{i=1}^n (\\text{EIF}(O_i) - \\bar{\\text{EIF}})^2}$，$t = \\frac{\\bar{\\text{EIF}}}{SE(\\bar{\\text{EIF}})}$。有限方差检验：$s^2 = \\frac{1}{n-1}\\sum_{i=1}^n \\text{EIF}(O_i)^2$，绘制直方图和核密度。正交性验证：比较不同bridge估计精度下的$\\hat{\\psi}$偏差与方差，粗糙估计偏差大但方差变化小，精细估计偏差小且方差稳定，符合正交性预期。",
      "status": "match",
      "match_type": "secondary_llm_verification"
    },
    "(6)": {
      "path": "(6)",
      "expected": "- 构造 EIF 的关键难点：\n  1) 桥函数可解性与完备性：\n     - proximal 框架要求存在 h1, h0, q0, q1 使得若干积分方程成立，并且在相应函数空间中是唯一解。这依赖 Z, W 对未观测混杂 U, V 的信息要“足够丰富”，通常形式化为完备性假设。该类假设在应用中难以直接验证，是整个理论的关键且脆弱环节。\n  2) 反问题与数值不适定性：\n     - bridge 函数通过逆条件期望算子 T0, T1 定义，本质上是反问题或算子逆问题，可能病态，对噪声和模型设定高度敏感，需要正则化与灵活的非参数方法。\n  3) 模型错设风险：\n     - 在有限样本中只能用有限维或机器学习模型近似 bridge 函数，若逼近能力不足或设定不当，可能导致桥方程在样本层面无法近似满足，从而影响 EIF 的无偏性与效率。\n\n- 可能导致 bridge 函数不存在或不唯一的情形：\n  1) 代理变量过弱或无关：\n     - 若 Z, W 与 U, V 几乎独立或相关性极弱，则无法通过 Z, W 恢复关于 U, V 的足够信息，导致 integral equations 可能无解或多解，bridge 函数不存在或不唯一，EIF_theory(O) 的理论基础随之失效。\n  2) 条件独立结构不成立：\n     - proximal mediation 通常依赖结构假设，如给定 (A, M, X, U, V) 时 Z 不再对 Y 有额外影响等。若真实数据生成机制违反这些结构，题设的桥方程本身就不正确，此时任何基于这些方程推导的 EIF 都不再对应目标参数 ψ。\n  3) 支持或重叠性差：\n     - 若在某些 (W, X, M) 区域内，仅 A=0 或仅 A=1 出现（缺乏重叠），则 f(A=1|W, X)/f(A=0|W, X) 等比值极不稳定或不可定义，q0, q1 可能无法良好定义或具有无限方差，桥函数的存在性和有限方差性受到破坏。\n\n- q0、q1 严重错设对 ψ_hat 与 EIF 性质的影响：\n  1) q0, q1 直接参与权重与残差校正，如果其估计 q0_hat, q1_hat 严重偏离真实函数：\n     - bridge 方程在样本中无法近似满足；\n     - EIF_hat 的样本均值不再接近 0，从而 ψ_hat 失去无偏或一致性；\n     - EIF 的方差估计基于错误的影响函数，导致标准误和置信区间严重失真，可能过于乐观或悲观。\n  2) 虽然 canonical EIF 具有对 nuisance 估计误差的一阶正交性，但这种正交性仅在 bridge 函数属于可逼近的正确模型类且估计收敛速度足够快时起作用。若 q0、q1 模型严重错设，则误差不再是“高阶小量”，而是主导项，正交性无法挽救 ψ_hat 的偏差。\n\n综上，proximal mediation 下 EIF 的理论构造依赖于代理变量的质量、桥函数的存在与唯一性以及合理的估计方法。一旦这些前提被破坏，canonical EIF 形式 EIF_theory(O) 及其基于 EIF 的推断就可能失效，需要在建模与诊断中给予高度重视。",
      "actual": "关键难点：bridge方程可解性、完备性条件验证、模型错设风险（如代理变量选择）。canonical EIF失效情形：代理变量$Z, W$太弱无法反映未观测混杂、条件独立结构不成立、样本量不足。$q_0$或$q_1$估计错设影响：$\\hat{\\psi}$不一致，破坏EIF零均值性，导致方差估计不准确，置信区间覆盖概率偏离名义水平。",
      "status": "match",
      "match_type": "secondary_llm_verification"
    }
  },
  "mode_folder": "with_tools_react"
}