# å·¥å…·æ³¨å†Œæµ‹è¯•è¯´æ˜

## æ¦‚è¿°

`gym/tool_loader.py` æä¾›äº†å®Œæ•´çš„å·¥å…·æ³¨å†Œæµ‹è¯•åŠŸèƒ½ï¼Œå¯ä»¥æ‰¹é‡æ£€æŸ¥æ‰€æœ‰æ•°æ®é›†æ–‡ä»¶ä¸­çš„å·¥å…·æ˜¯å¦èƒ½æˆåŠŸåŠ è½½å’Œæ³¨å†Œã€‚

## ä½¿ç”¨æ–¹æ³•

### 1. å•ä¸ªæ¡ˆä¾‹æµ‹è¯•ï¼ˆé»˜è®¤ï¼‰

```bash
python -m gym.tool_loader
```

æµ‹è¯•ç¬¬ä¸€ä¸ªæ¡ˆä¾‹çš„å·¥å…·æ³¨å†Œæƒ…å†µã€‚

### 2. å®Œæ•´æµ‹è¯•ï¼ˆæ‰€æœ‰æ•°æ®é›†æ–‡ä»¶ï¼‰

```bash
python -m gym.tool_loader --test-all
```

æµ‹è¯• `gym/dataset` ç›®å½•ä¸‹æ‰€æœ‰ JSON æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ¡ˆä¾‹ã€‚

### 3. è‡ªå®šä¹‰å‚æ•°

```bash
# æŒ‡å®šæ•°æ®é›†ç›®å½•
python -m gym.tool_loader --test-all --dataset-dir gym/dataset

# æŒ‡å®šè¾“å‡ºæ–‡ä»¶è·¯å¾„
python -m gym.tool_loader --test-all --output results/tool_test.json
```

## æµ‹è¯•è¾“å‡º

### æ§åˆ¶å°è¾“å‡º

æµ‹è¯•è¿‡ç¨‹ä¸­ä¼šå®æ—¶æ˜¾ç¤ºï¼š
- å¤„ç†çš„æ–‡ä»¶åˆ—è¡¨
- æ¯ä¸ªæ–‡ä»¶çš„æ¡ˆä¾‹æ€»æ•°
- æˆåŠŸ/å¤±è´¥çš„æ¡ˆä¾‹æ•°
- å¤±è´¥æ¡ˆä¾‹çš„é”™è¯¯ä¿¡æ¯ï¼ˆå‰5ä¸ªï¼‰
- æœ€ç»ˆæ±‡æ€»ç»Ÿè®¡

ç¤ºä¾‹è¾“å‡ºï¼š
```
ğŸ“‹ æ‰¾åˆ° 2 ä¸ªæ•°æ®é›†æ–‡ä»¶
================================================================================

ğŸ“‚ å¤„ç†æ–‡ä»¶: refine_merged_questions_augmented.json
  ğŸ“Š å…± 1000 ä¸ªæµ‹è¯•æ¡ˆä¾‹
    âœ“ å·²å¤„ç† 100/1000 ä¸ªæ¡ˆä¾‹
    âœ“ å·²å¤„ç† 200/1000 ä¸ªæ¡ˆä¾‹
  âœ… æˆåŠŸ: 950, âŒ å¤±è´¥: 50

ğŸ“Š æµ‹è¯•æ±‡æ€»:
  æ€»æ¡ˆä¾‹æ•°: 2000
  âœ… æˆåŠŸ: 1900
  âŒ å¤±è´¥: 100
  æˆåŠŸç‡: 95.00%
  ç»“æœå·²ä¿å­˜åˆ°: gym/dataset/tool_registration_test_results.json
```

### JSON è¾“å‡ºæ–‡ä»¶

æµ‹è¯•ç»“æœä¼šä¿å­˜åˆ° JSON æ–‡ä»¶ä¸­ï¼ŒåŒ…å«ï¼š

```json
{
  "test_timestamp": "...",
  "dataset_dir": "gym/dataset",
  "total_files": 2,
  "summary": {
    "total_cases": 2000,
    "total_success": 1900,
    "total_failed": 100,
    "success_rate": "95.00%"
  },
  "files": [
    {
      "filename": "refine_merged_questions_augmented.json",
      "total_cases": 1000,
      "success_cases": 950,
      "failed_cases": 50,
      "failed_details": [
        {
          "case_id": 123,
          "subject": "Physics",
          "topic": "Mechanics",
          "error_type": "FileNotFoundError",
          "error_message": "æ‰¾ä¸åˆ°å·¥å…·æ–‡ä»¶: ./tools/xxx.py",
          "usage_tool_protocol_count": 2,
          "tool_paths": ["./tools/xxx.py", "./tools/yyy.py"]
        }
      ]
    }
  ]
}
```

## å¤±è´¥è¯¦æƒ…è¯´æ˜

æ¯ä¸ªå¤±è´¥æ¡ˆä¾‹ä¼šè®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š

- `case_id`: æ¡ˆä¾‹ID
- `subject`: å­¦ç§‘ï¼ˆä» metadata ä¸­æå–ï¼‰
- `topic`: ä¸»é¢˜ï¼ˆä» metadata ä¸­æå–ï¼‰
- `error_type`: é”™è¯¯ç±»å‹ï¼ˆå¦‚ FileNotFoundError, ImportError ç­‰ï¼‰
- `error_message`: é”™è¯¯æ¶ˆæ¯
- `usage_tool_protocol_count`: å·¥å…·åè®®æ•°é‡
- `tool_paths`: å·¥å…·æ–‡ä»¶è·¯å¾„åˆ—è¡¨

## å¸¸è§é”™è¯¯ç±»å‹

### 1. FileNotFoundError
**åŸå› **: æ‰¾ä¸åˆ°å·¥å…·æ–‡ä»¶
**è§£å†³**: æ£€æŸ¥ `function_path` æ˜¯å¦æ­£ç¡®ï¼Œæ–‡ä»¶æ˜¯å¦å­˜åœ¨äº `toolkits/{subject}/{topic}/` ç›®å½•

### 2. ImportError
**åŸå› **: å¯¼å…¥æ¨¡å—å¤±è´¥
**è§£å†³**: æ£€æŸ¥å·¥å…·æ–‡ä»¶æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ï¼Œä¾èµ–æ˜¯å¦å®‰è£…

### 3. ValueError: æœªæ‰¾åˆ°ä»»ä½•å·¥å…·åè®®
**åŸå› **: æµ‹è¯•æ¡ˆä¾‹ä¸­æ²¡æœ‰ `usage_tool_protocol` æˆ–ä¸ºç©º
**è§£å†³**: æ£€æŸ¥æ•°æ®é›†æ ¼å¼

### 4. ValueError: æœªæ‰¾åˆ°ä»»ä½•å·¥å…·å‡½æ•°
**åŸå› **: å·¥å…·æ–‡ä»¶ä¸­æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„å‡½æ•°
**è§£å†³**: æ£€æŸ¥å‡½æ•°åæ˜¯å¦ä¸åè®®ä¸­çš„ `name` ä¸€è‡´

## æ€§èƒ½è¯´æ˜

- æµ‹è¯•é€Ÿåº¦å–å†³äºæ•°æ®é›†å¤§å°å’Œå·¥å…·æ–‡ä»¶å¤æ‚åº¦
- å»ºè®®åœ¨æµ‹è¯•æ—¶ä½¿ç”¨è¿›åº¦æç¤ºï¼ˆæ¯100ä¸ªæ¡ˆä¾‹æ˜¾ç¤ºä¸€æ¬¡ï¼‰
- å¤§å‹æ•°æ®é›†ï¼ˆ>1000æ¡ˆä¾‹ï¼‰å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´

## ç¤ºä¾‹ï¼šåˆ†ææµ‹è¯•ç»“æœ

```python
import json
from pathlib import Path

# è¯»å–æµ‹è¯•ç»“æœ
with open('gym/dataset/tool_registration_test_results.json', 'r') as f:
    results = json.load(f)

# åˆ†æå¤±è´¥æ¡ˆä¾‹
failed_cases = []
for file_result in results['files']:
    for detail in file_result.get('failed_details', []):
        failed_cases.append(detail)

# æŒ‰é”™è¯¯ç±»å‹ç»Ÿè®¡
error_types = {}
for case in failed_cases:
    error_type = case['error_type']
    error_types[error_type] = error_types.get(error_type, 0) + 1

print("é”™è¯¯ç±»å‹ç»Ÿè®¡:")
for error_type, count in error_types.items():
    print(f"  {error_type}: {count}")
```

## æ³¨æ„äº‹é¡¹

1. **è·¯å¾„é—®é¢˜**: ç¡®ä¿ `toolkits/{subject}/{topic}/` ç›®å½•ç»“æ„æ­£ç¡®
2. **æ–‡ä»¶æƒé™**: ç¡®ä¿æœ‰è¯»å–æ•°æ®é›†æ–‡ä»¶å’Œå·¥å…·æ–‡ä»¶çš„æƒé™
3. **å†…å­˜ä½¿ç”¨**: å¤§å‹æ•°æ®é›†å¯èƒ½å ç”¨è¾ƒå¤šå†…å­˜
4. **è¾“å‡ºæ–‡ä»¶**: æµ‹è¯•ç»“æœä¼šè¦†ç›–åŒåçš„è¾“å‡ºæ–‡ä»¶








